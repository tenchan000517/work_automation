# 業務効率化・マニュアル作成プロジェクト HANDOFF

## プロジェクト概要

制作陣の業務効率化とマニュアル整備プロジェクト。
9商材・52業務を対象に、AI活用による効率化とマニュアル改善を推進。

**ガイドライン**:
- `docs/manual-creation-guideline-v2.md` ★最新版（GASダイアログ設計指針）
- `docs/manual-creation-guideline.md` 旧版（データ構造・型定義の参照用）

---

## 設計思想

### スプレッドシート中心の設計
本体はスプレッドシート+GAS。Next.jsサイトは補助（閲覧用ビュー）。

**理由**: 担当者が直接メンテナンスできる。コード変更不要。

### GASの2つの機能
- **AIプロンプト生成**: データ+プロンプト → AIに貼り付け → AI出力を使う
- **フォーマット生成**: データ+テンプレート → そのまま使える定型文

### 基本セット構成
- プロンプトシート（AIプロンプト管理）
- 設定シート（担当者名等の設定値）
- フォーム連携時: 回答シート + 原本シート

### 入力データの永続化
ダイアログで入力したデータは一時的ではなく、スプレッドシートに保存して再利用する。

**フロー:**
1. 貼り付け → 対象シートのセルに保存
2. 次回開く → セルから読み込み → フィールドに自動入力
3. 後続フローでも同じデータを参照可能

---

## 商材別業務一覧

| 商材 | 業務数 | 進捗 |
|------|--------|------|
| ツナゲル | 14 | GAS実装済み |
| バツグン | 5 | 基本情報のみ |
| HP制作 | 8 | 基本情報のみ |
| LP制作 | 5 | 基本情報のみ |
| SNS広告 | 5 | 基本情報のみ |
| PV制作 | 5 | 基本情報のみ |
| パンフ | 3 | 基本情報のみ |
| ロゴ | 3 | 基本情報のみ |
| 月刊Sing | 4 | 基本情報のみ |
| **合計** | **52** | - |

---

## GASメニュー構成（ツナゲル）

```
０.⚙️ 設定
├── 👥 メンバー編集
├── 📝 業務担当者編集
├── 📁 フォルダ設定編集
├── ─────────────
├── 📄 プロンプト編集
├── ─────────────
├── 📋 設定シートを作成
├── 📝 プロンプトシートを作成
└── 📊 企業情報一覧を作成

１.📋 企業情報入力
├── 📥 企業情報入力（ワークス貼り付け）
├── 📢 受注・キックオフ連絡
├── 📩 先方へ日程調整・フォーム記入依頼メール
├── ─────────────
├── 🏢 企業情報編集
├── ─────────────
└── 📊 企業情報一覧反映

２.📋 初回打ち合わせ
├── 🆕 新規ヒアリングシート作成（フォーム回答から）
├── 🆕 新規ヒアリングシート作成（手動）
├── ─────────────
├── 📂 新規フォルダ作成（企業シートから）
├── 🆕 新規フォルダ作成（手動）
├── ─────────────
├── 📥 フォーム回答を既存シートに転記
├── ─────────────
├── 📋 最近作成した企業フォルダ一覧
├── ─────────────
├── 🎨 テンプレート初期設定
└── ⚙️ 親フォルダを設定

３.📝 議事録作成
├── （プロンプトシートから動的生成）
├── ─────────────
├── 📋 文字起こしを整理（プロンプト生成）
├── 📥 AI出力を転記
├── ─────────────
├── 📄 プロンプトシートを作成
├── 🔄 サンプルプロンプトを追加
└── ❓ 使い方

４.📝 構成案作成
├── 📋 構成案を作成（プロンプト生成）
├── ─────────────
├── 📤 ペアソナ/エンゲージ形式に変換
├── 📤 ワークス報告用に変換
├── 📤 撮影指示書に変換
├── ─────────────
├── 📸 撮影日程確定報告
├── ─────────────
└── 🔧 シートデータ確認

📨 連絡フォーマット
├── 📋 日程確定報告
├── ─────────────
├── 📷 撮影日程確認
├── 🔔 参加者リマインド
├── ─────────────
├── 🎬 撮影指示連絡
├── 📸 撮影日程確定報告
└── 📝 議事録共有
```

---

## GASファイル構成

```
docs/gas/tsunageru/
├── commonStyles.js           # ★共通スタイル定義
├── settingsSheet.js          # 0.設定シート管理
├── hearingSheetManager.js    # メイン（onOpen含む）2.初回打ち合わせ
├── companyInfoManager.js     # 1.企業情報入力
├── promptDialog.js           # 3.議事録作成
├── compositionDraftGenerator.js # 4.構成案作成
├── contactFormats.js         # 連絡フォーマット
├── transcriptToHearingSheet.js  # 文字起こし転記（3に統合）
├── createShootingFolder.js   # 撮影フォルダ作成（2に統合）
├── companyCueGenerator.js    # 企業カンペ作成
└── sheetStructureChecker.js  # メンテナンス用
```

---

## Next.jsサイト共通化（src/lib/data/common/）

商材共通のマニュアル・テンプレートを切り出し、tsunageru.ts等から参照する構成。

```
src/lib/data/common/
├── index.ts
├── manuals/
│   ├── index.ts
│   ├── gas-auth.ts           # GAS認証フロー説明
│   ├── notta.ts              # NOTTA使い方（起動・終了・準備確認）
│   └── works-reaction.ts     # ワークスリアクションルール
└── templates/
    ├── index.ts
    ├── order-notification.ts     # 受注連絡（商材名を引数で渡す）
    ├── schedule-confirm.ts       # 日程確定報告
    ├── reminder.ts               # リマインド
    ├── shooting-request.ts       # 撮影日程確認
    ├── shooting-instruction.ts   # 撮影指示
    └── minutes-share.ts          # 議事録共有
```

**テンプレート関数の使い方:**
```typescript
// 商材名を渡すだけで使える
createOrderNotificationTemplate("ツナゲル", "12ヶ月")
createOrderNotificationTemplate("HP制作", "制作")

// 引数なしで呼び出し
createScheduleConfirmTemplate()
createReminderTemplate()
```

---

## ヒアリングシート構成

### Part① 基本情報（フォーム回答から自動転記）
企業名、担当者名、業種、所在地、従業員数など

### Part② ヒアリング情報（打ち合わせ時記入）
- 会社紹介（私たちについて、社長挨拶、会社の魅力、雰囲気）
- 社員の声（最低2名）
- 求人写真
- 重要セクション（★★★）
- 募集情報
- 管理情報
- スカウトメール設定
- **撮影準備**（撮影場所、駐車場、当日担当者、緊急連絡先、必要備品、撮影日時、集合時間）

### Part③ 処理データ（システム管理）
- 撮影素材フォルダURL
- メインフォルダURL
- 文字起こし原文
- 議事録
- 構成案
- ペアソナ/エンゲージ
- 撮影指示書
- 企業カンペURL

---

## 設定シート構成

| 列 | 内容 |
|----|------|
| A-B列 | メンバー一覧 |
| D-F列 | 業務担当者 |
| H-I列 | フォルダ設定 |
| K列 | 企業情報項目 |
| M-N列 | 保存キーマッピング（プロンプト名→Part③保存先） |
| P-Q列 | Part③構成（ラベル名、行数） |

---

## 確定UI一覧

| 項目 | 仕様 |
|------|------|
| ダイアログ横幅 | 700px |
| ダイアログ高さ | 750px（基本値） |
| 担当者選択 | コンパクトドロップダウン |
| 企業選択 | カスタムドロップダウン（チェック・ハイライト・アクティブバッジ） |
| テンプレート表示 | 白背景+枠線、コピーボタンはタイトル行右端 |
| プレビューUI | カード形式、緑コピーボタン |

---

## ワークスのスタンプルール

| ルール | 説明 |
|--------|------|
| ①完了していないならスタンプを押さない | スタンプ = 完了の意思表示 |
| ②5分以上かかるものはタスク・カレンダーに落とし込んでからスタンプ | すぐ対応できないものは先にタスク化 |
| ③既読したらOKスタンプ → 完了したらグッドスタンプに変更 | 👌（OK）= 確認した、対応中 / 👍（グッド）= 完了した |

---

## 撮影関連情報フロー

```
① 日程調整メール
   └→ 「撮影日程を打ち合わせ時に決められれば」+ インタビュイー確認依頼

② 初回打ち合わせ
   └→ 撮影場所、駐車場、当日担当者、緊急連絡先等を聞く

③ 議事録プロンプト
   └→ AIが文字起こしから撮影関連情報も抽出して出力

④ 文字起こし→ヒアリングシート転記
   └→ Part②に自動転記

⑤ 撮影日程確定報告ダイアログ
   └→ Part②から自動読み込み
```

---

## マニュアルのmd分離（実装中）

tsunageru.tsの`manualDraft`をmdファイルに分離し、メンテナンス性を向上させる。

**ファイル配置:**
```
docs/manuals/
├── common/          # 共通マニュアル（複数商材で共有）
│   └── *.md
└── tsunageru/       # 商材固有マニュアル
    ├── 00-受注・ワークス立ち上げ.md
    ├── 01-初回打ち合わせ日程調整.md
    ...
    └── 14-月次FB打合せ.md
```

**読み込み関数:**
- `getManualByTaskNo(productId, taskNo)` → 商材固有マニュアル
- `getCommonManual(name)` → 共通マニュアル

**使用パッケージ:**（インストール済み）
```bash
npm install react-markdown remark-gfm rehype-raw
```

**実装済み:**
- [x] パッケージインストール
- [x] ディレクトリ作成（docs/manuals/tsunageru/）
- [x] lib/manuals.ts作成（md読み込み関数）
- [x] ManualMarkdownRenderer.tsx作成（Client Component）
- [x] manual/page.tsx改修（Server Component方式）

**アーキテクチャ:** Server Component方式（ベストプラクティス）
```
manual/page.tsx (Server Component)
    ↓ getManualByTaskNo() で fs.readFile
    ↓ content を props で渡す
ManualMarkdownRenderer (Client Component)
    ↓ react-markdown でレンダリング
```

**残タスク:**
- [ ] 全15タスクのmdファイル作成（No.0〜14）
- [ ] tsunageru.tsの`manualDraft`削除（任意）

**タスク一覧（tsunageru）:**
| No | タスク名 | ファイル名 |
|----|----------|-----------|
| 0 | 受注・ワークス立ち上げ | 00-受注・ワークス立ち上げ.md |
| 1 | 初回打ち合わせ日程調整 | 01-初回打ち合わせ日程調整.md |
| 2 | 打ち合わせ前準備 | 02-打ち合わせ前準備.md |
| 3 | オンライン初回打ち合わせ | 03-オンライン初回打ち合わせ.md |
| 4 | 打ち合わせ後対応 | 04-打ち合わせ後対応.md |
| 5 | ヒアリング内容整理 | 05-ヒアリング内容整理.md |
| 6 | 企画・質問設計 | 06-企画・質問設計.md |
| 7 | 撮影 | 07-撮影.md |
| 8 | 編集 | 08-編集.md |
| 9 | 原稿執筆 | 09-原稿執筆.md |
| 10 | 企業担当へ確認依頼 | 10-企業担当へ確認依頼.md |
| 11 | 今後の担当者の共有とスケジュール共有 | 11-今後の担当者の共有とスケジュール共有.md |
| 12 | 企業・応募者へ連絡 | 12-企業・応募者へ連絡.md |
| 13 | 週間データの集計と資料作成 | 13-週間データの集計と資料作成.md |
| 14 | 月次FB打合せ | 14-月次FB打合せ.md |

**作業手順:**
1. tsunageru.tsの該当タスクの`manualDraft`を確認
2. `docs/manuals/tsunageru/{No}-{タスク名}.md` を作成
3. 動作確認: `http://localhost:3000/products/tsunageru/tasks/{No}/manual`
4. 「Markdown」バッジが表示されればOK

**mdファイル記述例:**
```markdown
# 受注・ワークス立ち上げマニュアル

## 目的
受注後、制作チームが業務を開始できる状態を整える。

## 作業手順

### 1. 受注確定を確認

### 2. ワークスで企業グループを新規作成

<img src="/images/lineworks-sample.png" alt="ワークス画面" />

### 3. フォーマットを送信

<a href="https://docs.google.com/spreadsheets/d/xxx" target="_blank" class="btn-link">
  ヒアリングシート
</a>

<button class="btn-copy" data-content="ここにコピーする内容を記述">
  フォーマットをコピー
</button>

### 動画マニュアル

<video controls width="100%">
  <source src="/videos/tutorial.mp4" type="video/mp4">
</video>

<iframe width="560" height="315" src="https://www.youtube.com/embed/xxxxx" frameborder="0" allowfullscreen></iframe>
```

**対応機能:**
- マークダウン装飾（見出し、リスト、テーブル等）
- 画像表示（`<img>`）
- 動画埋め込み（`<video>`, YouTube `<iframe>`）
- リンク（`<a>`、`class="btn-link"`でボタン風）
- コピーボタン（`<button class="btn-copy" data-content="...">`）
- 任意のHTML埋め込み（rehype-raw）

**フォールバック動作:**
mdファイルが存在しない場合は既存の`task.manualDraft`を表示（移行期間中も動作保証）

---

## 将来の改善

### 「各種フォーマット」シートの作成
メールテンプレートなどのフォーマットを「各種フォーマット」シートから取得するように改善する。

**実装タスク:**
1. 設定メニューに「📋 各種フォーマットシートを作成」「📝 各種フォーマット編集」を追加
2. `initializeFormatSheet()` - 各種フォーマットシート作成関数
3. `showFormatEditDialog()` - 各種フォーマット編集ダイアログ
4. `getFormatFromSheet(formatName)` - フォーマット取得関数

---

## 開発コマンド

```bash
npx tsc --noEmit    # TypeScriptエラーチェック（コード変更後は必ず実行）
```

---

## 担当者一覧（ツナゲル）

| 担当者 | 色 | 主な業務 |
|--------|-----|---------|
| 渡邉 | グレー | 受注・立ち上げ、日程調整 |
| 河合 | ピンク | 打ち合わせ、原稿、編集 |
| 中尾文香 | 黄色 | 原稿執筆 |
| 川崎 | 水色 | 企画、撮影、FB |
| 下脇田 | 紫 | FB |
| 紺谷 | オレンジ | 応募対応 |

---

## 更新履歴

| 日付 | 内容 |
|------|------|
| 2026-01-13 | マニュアルmd分離実装（Server Component方式に変更、lib/manuals.ts、ManualMarkdownRenderer.tsx） |
| 2026-01-13 | マニュアルmd分離の設計決定（react-markdown + rehype-raw、HTML埋め込み対応） |
| 2026-01-13 | Next.jsサイト共通化（common/manuals, common/templates）、ワークススタンプルール追加 |
| 2026-01-13 | 撮影関連情報フロー実装、日程調整メール更新、GASメニュー名変更 |
| 2026-01-13 | 企業カンペ機能実装（3シート構成、5列化、チェックボックス） |
| 2026-01-13 | 撮影日程確定報告ダイアログ実装 |
| 2026-01-12 | Part③構成を設定シートで管理、保存機能追加 |
| 2026-01-12 | 全ダイアログをドロップダウンUI形式に統一 |
| 2026-01-12 | プロンプトシートにカテゴリ列追加 |
| 2026-01-11 | 企業選択UI共通化、commonStyles.js作成 |
| 2026-01-11 | GASメニュー構成変更、companyInfoManager.js新規作成 |
| 2026-01-10 | 入力データの永続化（Part③）、撮影フォルダ作成改善 |
| 2026-01-10 | settingsSheet.js作成、contactFormats.js作成 |
