# 業務効率化・マニュアル作成プロジェクト HANDOFF

## 🎯 次世代セッションタスク（2026-01-31 更新）

### HP制作フロー改善

HP制作のフローをツナゲルと同じ設計思想で整備する。

**現在のステータス:** hp.tsのflowSteps詳細化 ★今ここ

---

#### ✅ 完了した作業

- タスク分割設計（11タスク構成）
- hp.tsの再構築
- Googleフォーム設計・作成・GAS適用
- ヒアリングシート構造設計（4パート構成）
- Part②ヒアリング項目設計（39項目）
- **全10個のGASファイル作成完了**
- **マニュアル全11タスク詳細化完了**（No.0〜10）
- **GASテスト（Part①〜③転記）** - フォーム回答からの転記動作確認＆修正
- **マニュアル更新（01-打ち合わせ前準備）** - メニュー名修正、スクショ追加
- **プロンプトシート構造統一** - settingsSheet.jsに一本化（6列構造）
- **メニュー統合** - 「3.文字起こし転記」を「2.ヒアリング反映」に統合（メニュー6→5個に）
- **JSON出力自動保存** - 生成時にPart④へ自動保存
- **サンプルデータ作成** - 中部建設のCSV・文字起こしサンプル
- **構成案プロンプト大幅改善** - 3人の専門家プロンプト、反AIデザイン哲学、選択ページ連携
- **メニュー統合（2回目）** - 「4.JSON出力」と「5.構成案作成」を統合（メニュー5→4個に）
- **Claude Code指示文大幅改善** - 実装指示→セットアップ指示に変更、HANDOFF生成方式

#### ✅ HP制作GAS（全て完了）

| ファイル | 機能 |
|---------|------|
| `formCreator.js` | Googleフォームセットアップ |
| `hearingSheetManager.js` | メインGAS（onOpen、シート作成、フォーム転記、企業フォルダ作成） |
| `settingsSheet.js` | 設定シート・プロンプトシート管理 |
| `commonStyles.js` | 共通スタイル（ツナゲルから流用） |
| `progressManager.js` | ステータス管理・進捗一覧 |
| `promptDialog.js` | 議事録作成・プロンプト実行 |
| `createFolder.js` | 素材フォルダ作成（チェックボックス選択式） |
| `transcriptToHearingSheet.js` | 文字起こし転記（Part②39項目対応） |
| `jsonOutputDialog.js` | JSON出力（Part①②、サーバー情報除外） |
| `compositionPrompt.js` | 構成案プロンプト + Claude Code指示文 |

---

#### 📋 次にやること（優先順）

##### ~~STEP 1: マニュアル更新・スクショ挿入~~ ✅完了
スクショ挿入と最新GASに合わせた更新が完了。

##### ~~STEP 2: 構成案プロンプト改善~~ ✅完了
3人の専門家プロンプトを実装：
- **専門家①**: WEBマーケティングプロ（コンバージョンファネル、心理トリガー、ABテスト）
- **専門家②**: 求人コンサルタント（求職者インサイト、情報開示戦略、感情設計）
- **専門家③**: WEBデザイナー（反AIデザイン哲学、余白の呼吸、装飾の引き算）

**修正したGAS:**
- `createFolder.js` - 選択ページをPart④に保存
- `compositionPrompt.js` - 3人の専門家プロンプト、プロンプトシート読み込み、選択ページ連携
- `settingsSheet.js` - プロンプトシート作成時に構成案プロンプト自動登録

##### ~~STEP 3: Claude Code指示文ブラッシュアップ~~ ✅完了
Claude Code指示文を「実装指示」から「セットアップ指示」に変更。

**変更内容:**
- ダイアログにテンプレート選択UI追加（5種類）
- 技術スタック修正（Next.js 16.1.6、React 19.2.3、Tailwind 4.x等）
- 開発環境の注意点追加（WSL2でTurbopack不可→--webpackフラグ）
- 指示文の役割を変更:
  1. 企業ディレクトリ作成（`/mnt/c/hp-projects/{{companyName}}/`）
  2. 生データ保存（`data/hearing.json`, `data/composition.md`）
  3. HANDOFF.md作成（進捗管理・引き継ぎ用）
  4. 次世代セッションへの引き継ぎ指示出力

**修正したGAS:**
- `compositionPrompt.js` - HP_CLAUDE_CODE_PROMPT_TEMPLATE全面改修、ダイアログにテンプレート選択追加

##### ~~STEP 4: マニュアル更新~~ ✅完了
Claude Code指示文の変更に合わせてマニュアルを更新。

**対象マニュアル:** `docs/manuals/hp/04-JSON出力・原稿生成.md`

**更新内容:**
- メニュー番号を「4.📝 構成案作成」に統一
- テンプレート選択の説明を追加（5種類）
- 生成される指示文の役割（セットアップ指示書）を説明
- STEP 5〜6追加（Claude Codeセットアップ実行、次世代セッション開始）
- 技術スタックを最新版に更新（Next.js 16.1.6等）
- トラブルシューティング追加（セットアップ・次世代セッション関連）

##### STEP 5: 構成案プロンプトにClaude Code用出力指示を追加 ★今ここ

**背景:**
構成案プロンプトを使って中部建設の構成案を作成したが、現状のプロンプトには「どこに」「どう保存するか」の指示がない。そのため：
- コンソールに全出力しようとしてトークンオーバーする可能性
- ファイル分割・保存をAIが適切に判断できない

**成功例（中部建設）:**
```
/mnt/c/work-manual/chubu-kensetsu-hp/doc/wireframe/
├── README.md              # 概要・ファイル構成
├── 00_overview.md         # PART1: サイト全体の戦略設計
├── 01_top.md              # TOPページ詳細
├── 02_about.md            # Aboutページ詳細
├── ...（ページ数分）
├── 07_common_parts.md     # ヘッダー・フッター
└── 08_photo_guide.md      # 撮影指示書
```

**実装方針:**

1. **出力指示の追記テンプレートを作成**
   - `HP_COMPOSITION_PROMPT_TEMPLATE` はそのまま維持
   - Claude Code用に使う場合、追記部分（出力先・ファイル分割指示）を末尾に追加

2. **ダイアログでの選択方式**
   - 「構成案プロンプト生成」ダイアログに選択肢を追加:
     - [ ] Claude Codeで実行する（ファイル保存指示を追加）
   - チェックON時: プロンプト末尾に出力指示を追加

3. **出力指示テンプレートの内容**
   ```markdown
   ## 【出力方法】

   以下のディレクトリ構造で保存してください：

   /mnt/c/work-manual/{{companyName}}-hp/doc/wireframe/
   ├── README.md
   ├── 00_overview.md         # PART1: サイト全体の戦略設計
   ├── 01_[ページ名].md       # 各ページ詳細（選択ページ分）
   ├── ...
   ├── [N]_common_parts.md    # ヘッダー・フッター
   └── [N+1]_photo_guide.md   # 撮影指示書

   ※ 一度に全て出力せず、ファイルごとに作成・保存すること
   ※ ページファイルは選択ページに応じて動的に生成
   ```

4. **注意点**
   - ページ詳細のファイル名は固定値ではなく、選択ページから動的に生成
   - 例: 選択ページが「TOP, About, Service」なら → `01_top.md`, `02_about.md`, `03_service.md`

**対象ファイル:**
- `docs/gas/hp/compositionPrompt.js`
  - `HP_CLAUDE_CODE_OUTPUT_INSTRUCTION` 追加（出力指示テンプレート）
  - `hp_createCompositionPromptDialogHTML()` にチェックボックス追加
  - チェックON時に出力指示を末尾追加するロジック

**参考:**
- 成功例: `/mnt/c/work-manual/chubu-kensetsu-hp/doc/wireframe/` （全9ファイル、計128KB）

##### STEP 6: hp.tsのflowSteps詳細化
ツナゲルのようにflowStepsに詳細情報を追加。
- `summary`: ステップの概要
- `description`: 詳細な手順説明
- `links`: 必要なリンク

##### STEP 6: GASテスト（残り）
- [x] 1.📋 HP制作 ✅
- [x] ⚙️ 設定 ✅
- [x] 2.📝 ヒアリング反映 ✅（旧:議事録作成+文字起こし転記を統合）
- [x] 3.📁 素材フォルダ ✅
- [x] 4.📤 JSON出力 ✅（自動保存機能追加）
- [x] 5.📝 構成案作成 ✅
- [ ] 📊 進捗管理

---

#### 📊 マニュアル進捗状況（全完了）

全11タスクのマニュアル詳細化が完了。各マニュアルには以下が含まれる：
- 基本情報テーブル（担当者、使用ツール、前後工程）
- フロー概要（図解）
- 作業手順（STEP形式）
- チェックポイント
- トラブルシューティング

**マニュアル格納場所:** `docs/manuals/hp/`

---

### ツナゲル検証・インフォ更新

新しいフローでの検証を行い、スクショ撮影→インフォ更新→マニュアル更新を進める。

**現状:**
- No.0〜5: インフォ/マニュアル作成済み（更新が必要な可能性）
- No.6〜13: 基本情報のみ、詳細フロー未確定

**必読ドキュメント:** `docs/manual-creation-guideline-v3.md`

---

## プロジェクト概要

制作陣の業務効率化とマニュアル整備プロジェクト。
9商材・52業務を対象に、AI活用による効率化とマニュアル改善を推進。

**ガイドライン:**
- `docs/manual-creation-guideline-v3.md` ★最新版（新商材作成の完全ガイド）
- `docs/manual-creation-guideline-v2.md` UI仕様詳細（GASダイアログ）
- `docs/manual-creation-guideline.md` 旧版（データ構造参照用）

---

## 設計思想

### スプレッドシート中心の設計
本体はスプレッドシート+GAS。Next.jsサイトは補助（閲覧用ビュー）。
理由: 担当者が直接メンテナンスできる。コード変更不要。

### GASの2つの機能
- **AIプロンプト生成**: データ+プロンプト → AIに貼り付け → AI出力を使う
- **フォーマット生成**: データ+テンプレート → そのまま使える定型文

### GASセットアップ時の注意点
- **Drive APIサービスの追加が必要**（フォルダ作成機能を使う場合）
- Apps Scriptエディタ → 左メニュー「ライブラリ」の下にある「サービス」→「+」→「Drive API」を追加
- これをしないとフォルダ作成系の機能が動作しない

### 基本セット構成
- プロンプトシート（AIプロンプト管理）
- 設定シート（担当者名等の設定値）
- フォーム連携時: 回答シート + 原本シート

### 入力データの永続化
ダイアログで入力したデータはスプレッドシートに保存して再利用する。

### 表現ルール（非エンジニア向け）
- 「GAS」は使わない → 「ヒアリングシートのメニュー」
- ダイアログサイズは700x750に統一

---

## 商材別業務一覧

| 商材 | 業務数 | 進捗 |
|------|--------|------|
| ツナゲル | 14 | GAS実装済み |
| HP制作 | 11 | GAS完了・マニュアル完了（GASテスト待ち） |
| バツグン | 5 | 基本情報のみ |
| LP制作 | 5 | 基本情報のみ |
| SNS広告 | 5 | 基本情報のみ |
| PV制作 | 5 | 基本情報のみ |
| パンフ | 3 | 基本情報のみ |
| ロゴ | 3 | 基本情報のみ |
| 月刊Sing | 4 | 基本情報のみ |
| **合計** | **52** | - |

---

## 関連リソース

### HP制作

| リソース | URL/パス |
|---------|---------|
| ヒアリングシート | https://docs.google.com/spreadsheets/d/1GO5fyOd-0lT_OMpLNw6rIZDRA6jrK4lzIAt-0tDxGvc/ |
| HP・LPフォルダ（親） | https://drive.google.com/drive/folders/1Zi2zn57JA3wZQvrEUwGN26jZkRDodWe- |
| HPテンプレート | `/mnt/c/sing-hp-template/` |
| 修正マニュアル | https://sing-hp-template.vercel.app/manual |
| GASファイル | `docs/gas/hp/` |
| マニュアル | `docs/manuals/hp/` |

### ツナゲル

| リソース | パス |
|---------|------|
| GASファイル | `docs/gas/tsunageru/` |
| マニュアル | `docs/manuals/tsunageru/` |

---

## 参照情報

### HP制作 ヒアリングシート構造

```
【上部（1〜3行目）】
├── 1行目: 企業名
├── 2行目: ステータスヘッダー（B〜G列）
├── 3行目: ステータス入力欄
└── H列: 公開URL

【右側（I〜N列）】
└── 更新ログ

【メインエリア（4行目〜）】
├── Part① 基本情報（フォームから自動転記）
├── Part② ヒアリング情報（打ち合わせで記入）★1行1情報
├── Part③ サーバー情報（フォームから転記 + 補足）
└── Part④ 処理データ（システム管理）
```

### HP制作 Part②ヒアリング項目（39項目）

**ヒアリングの流れ:**
1. ゴール・コンバージョンの確認
2. ターゲットの深掘り（ペルソナ設計）
3. 強みの深掘り（具体例を引き出す）
4. 表現の方向性（キャッチコピー、デザイン、撮影）
5. SEOキーワード設計
6. 新規作成の確認

<details>
<summary>詳細項目一覧（クリックで展開）</summary>

**1. ゴール・コンバージョン（2項目）**
- メインのコンバージョン
- ハードル設定

**2. ターゲットの深掘り（8項目）**
- 年齢層・性別
- 職業・役職・年収帯
- 居住地・勤務地
- 抱えている課題・悩み
- どんな状況で検索するか
- 検索しそうなキーワード
- 比較検討時に重視するポイント
- 問い合わせ・応募前の不安・障壁

**3. 強みの深掘り（8項目）**
- 選ばれる理由の具体例
- お客様・社員からよく言われる褒め言葉
- こだわり・譲れないポイント
- 資格・認定・特許など
- 独自の技術・ノウハウ
- 提出資料で特に使いたい部分
- 募集要項の推しポイント
- 働き方の強み

**4. 表現の方向性（9項目）**
- キャッチコピー既存案
- キャッチコピーイメージ
- 参考キャッチコピー
- デザインの深掘り
- NGイメージ
- 撮影の雰囲気
- 映したいもの
- 社風の具体例
- 表現したいキーワード

**5. SEO・キーワード設計（5項目）**
- 最重要キーワード（3つ）
- サブキーワード（5つ程度）
- ローカルSEO対象地域
- 現在の検索順位
- 競合キーワード

**6. 新規作成の確認（7項目）**
- 代表メッセージ作成方法
- 代表の強調点
- インタビュー対象者
- インタビュー人数
- インタビュー切り口
- よくある質問
- 誤解されたくないこと

</details>

### HP制作 GASメニュー構成

```
⚙️ 設定
├── 📋 設定シートを作成
├── 📝 プロンプトシートを作成
└── 📄 設定を表示

1.📋 HP制作
├── 🆕 新規ヒアリングシート作成（フォーム回答から）
├── 🆕 新規ヒアリングシート作成（手動）
├── 📂 企業フォルダ作成
├── 📥 フォーム回答を既存シートに転記
├── 📋 テンプレート初期設定
└── ✏️ ステータス更新

2.📝 ヒアリング反映 ★旧「議事録作成」+「文字起こし転記」を統合
├── 議事録作成（プロンプトシートから）
├── 📋 文字起こしを整理（プロンプト生成）
├── 📥 AI出力を転記
├── ❓ 使い方
└── ✏️ ステータス更新

3.📁 素材フォルダ

4.📝 構成案作成 ★JSON出力と統合
├── 📤 HP制作用JSON出力
├── ────────────
├── 📋 構成案プロンプト生成
├── 🤖 Claude Code指示文生成
└── ✏️ ステータス更新

📊 進捗管理
```

### HP制作 担当者

- 河合: メイン担当（ヒアリング〜納品〜月次FB）
- 川崎: 素材撮影
- 青柳: CC（全工程で報告を受ける）

### ツナゲル担当者

| 担当者 | 主な業務 |
|--------|---------|
| 渡邉 | 受注・立ち上げ、日程調整 |
| 河合 | 打ち合わせ、原稿、編集 |
| 中尾文香 | 原稿執筆 |
| 川崎 | 企画、撮影、FB |
| 下脇田 | FB |
| 紺谷 | 応募対応 |

---

## 開発コマンド

```bash
npx tsc --noEmit    # TypeScriptエラーチェック（コード変更後は必ず実行）
```

---

## 更新履歴

| 日付 | 内容 |
|------|------|
| 2026-01-31 | HP制作: 中部建設の構成案作成完了 → 次タスクとして「Claude Code用出力指示追加」をHANDOFFに記載。成功例を `/mnt/c/work-manual/chubu-kensetsu-hp/doc/wireframe/` に保存（9ファイル、128KB） |
| 2026-01-31 | HP制作: マニュアル更新（04-JSON出力・原稿生成）- メニュー統合反映、テンプレート選択説明追加、セットアップ指示書説明、次世代セッション開始方法追記、技術スタック更新 |
| 2026-01-31 | HP制作: Claude Code指示文大幅改善 - 「実装指示」→「セットアップ指示」に変更、ダイアログにテンプレート選択追加、企業ディレクトリ・HANDOFF生成方式に変更 |
| 2026-01-31 | HP制作: メニュー統合（2回目）- 「4.JSON出力」と「5.構成案作成」を「4.構成案作成」に統合（メニュー5→4個に） |
| 2026-01-31 | HP制作: フォルダ機能修正 - 企業フォルダ名を会社正式名称に変更、素材フォルダ→ページフォルダ追加に変更、Part④「素材フォルダURL」→「選択ページ」に変更、**GASにDrive APIサービス追加が必要**（ライブラリ下のサービスから追加） |
| 2026-01-31 | HP制作: 構成案プロンプト大幅改善 - 3人の専門家プロンプト、反AIデザイン哲学、選択ページ連携、プロンプトシート自動登録 |
| 2026-01-30 | HP制作: マニュアル更新完了（03, 04, 05, 06）- メニュー番号修正、スクショ10枚挿入 |
| 2026-01-30 | HP制作: GASテスト（Part①〜③転記修正）、プロンプトシート構造統一（settingsSheet.jsに一本化）、マニュアル更新（01-打ち合わせ前準備にスクショ追加） |
| 2026-01-30 | HP制作: HANDOFF整理（25907トークン→350行に簡潔化）、マニュアル全11タスク詳細化完了 |
| 2026-01-30 | HP制作: GAS全10ファイル作成完了、Googleフォーム作成・適用完了 |
| 2026-01-14 | GAS最適化: settingsSheet.js 4ダイアログにCI_DIALOG_STYLES/CI_UI_COMPONENTS適用、サイズ700x750統一、手動変更可能の説明追加 |
| 2026-01-14 | GAS最適化: commonStyles.jsにbtn-add、btn-delete追加 |
| 2026-01-14 | GAS最適化レポート作成（docs/gas-optimization-report.md）、将来改善に入力キー・保存キー管理を追加 |
| 2026-01-14 | 全14タスクのflowStepsに「ステータス更新」ステップを追加、表現ルール統一（GAS→ヒアリングシートのメニュー） |
| 2026-01-14 | ガイドラインv3更新（表現ルール、ステータス更新ステップ追加、品質チェック項目追加） |
| 2026-01-14 | 商材ページUI改善: 業務数・課題・サマリーを最下部に移動してアコーディオン化、Accordion.tsx新規作成 |
| 2026-01-14 | タスク定義を設定シートから取得するように変更（progressManager.js→getTasks()、hearingSheetManager.js連携） |
| 2026-01-14 | タスク統合（15→14タスク）: No.0とNo.1を統合、マニュアル・tsunageru.ts・GAS更新 |
| 2026-01-14 | ステータス更新ダイアログを全メニューに追加（企業情報入力、初回打ち合わせ、議事録作成、構成案作成、連絡フォーマット） |
| 2026-01-14 | 更新ログ機能追加（I〜N列、タスク変更・保持者変更・状態・メモ・工数を記録） |
| 2026-01-14 | ステータス欄を6項目に拡張（状態・全体ステータス追加、条件付き書式追加） |
| 2026-01-14 | 進捗管理機能実装（progressManager.js、ステータス管理・進捗一覧・進捗ログ） |
| 2026-01-14 | フローステップUI微調整（カード幅w-40、余白調整、ボタン統一、タイトル左余白ml-1） |
| 2026-01-14 | フローステップタイトル改善（タイトル簡潔化、summary追加、ボタン絵文字削除） |
| 2026-01-14 | モバイルハンバーガーメニュー実装（ProductPageLayoutにヘッダー統合、Menu↔Xアニメーション） |
| 2026-01-14 | フローステップデザイン完了（FlowStep.summary追加、ステップ番号バッジ、丸枠矢印、サイズ統一） |
| 2026-01-13 | フローステップデザイン改善（途中）: Task型にsummary追加、lucide-react矢印導入 |
| 2026-01-13 | ガイドラインV3作成（新商材作成の完全ガイド、設計思想・共通概念・ルール・作り方） |
| 2026-01-13 | フォーマット共通化（FB_REPORT_TEMPLATE, SHOOTING_CHECKLIST）3商材で共有 |
| 2026-01-13 | モバイル対応（ヘッダー、サイドメニュー、TaskCard、フローステップ） |
| 2026-01-13 | サイドメニュー実装（Sidebar.tsx、SidebarSection.tsx、ProductPageLayout.tsx） |
| 2026-01-13 | 全体フローを商材レベルに移動（/products/{id}/overall-flow） |
| 2026-01-13 | lucide-reactインストール、アイコン統一 |
| 2026-01-13 | ボタン表示問題解決（hasAnyDetailにフラグ追加、マニュアルボタン条件修正） |
| 2026-01-13 | フロー・ガイドラインmd分離完了（docs/flows/, docs/guidelines/、613行削減） |
| 2026-01-13 | tsunageru.tsのmanualDraft全削除完了（md分離作業完了） |
| 2026-01-13 | 全14タスクのmdファイル作成完了（docs/manuals/tsunageru/に00〜13のマニュアル） |
| 2026-01-13 | マークダウンスタイル問題修正（globals.css、ManualMarkdownRenderer.tsx更新、engineer-course準拠） |
| 2026-01-13 | マニュアルmd分離実装（Server Component方式に変更、lib/manuals.ts、ManualMarkdownRenderer.tsx） |
| 2026-01-13 | マニュアルmd分離の設計決定（react-markdown + rehype-raw、HTML埋め込み対応） |
| 2026-01-13 | Next.jsサイト共通化（common/manuals, common/templates）、ワークススタンプルール追加 |
| 2026-01-13 | 撮影関連情報フロー実装、日程調整メール更新、GASメニュー名変更 |
| 2026-01-13 | 企業カンペ機能実装（3シート構成、5列化、チェックボックス） |
| 2026-01-13 | 撮影日程確定報告ダイアログ実装 |
| 2026-01-12 | Part③構成を設定シートで管理、保存機能追加 |
| 2026-01-12 | 全ダイアログをドロップダウンUI形式に統一 |
| 2026-01-12 | プロンプトシートにカテゴリ列追加 |
| 2026-01-11 | 企業選択UI共通化、commonStyles.js作成 |
| 2026-01-11 | GASメニュー構成変更、companyInfoManager.js新規作成 |
| 2026-01-10 | 入力データの永続化（Part③）、撮影フォルダ作成改善 |
| 2026-01-10 | settingsSheet.js作成、contactFormats.js作成 |
