# 業務効率化・マニュアル作成プロジェクト HANDOFF

## 🎯 次世代セッションタスク（2026-01-30 更新）

### HP制作フロー改善（進行中）

HP制作のフローをツナゲルと同じ設計思想で整備する。

---

#### ✅ 完了した作業（2026-01-30）

1. **タスク分割設計の確定** - 11タスク構成に決定
2. **hp.tsの再構築** - 新しいタスク構成で実装完了
3. **マニュアルファイルの再構成** - 11ファイル作成完了
4. **No.0〜2マニュアル完成** - ツナゲルベース、画像付き、HP制作用にカスタマイズ
5. **リソース・フォルダ設計確定** - ヒアリングシートURL、フォルダ構造、テンプレート選択タイミング
6. **Googleフォーム設計完了** - サーバー情報の条件分岐質問項目を整理
7. **サーバー移管手順の整理** - お名前.com基準、メール維持パターン含む
8. **Googleフォーム作成完了** - GASでセットアップ、全質問項目を実装

---

#### 📋 次世代セッションでの作業（優先順）

##### ~~STEP 1: Googleフォームの作成~~ ✅完了

GASでセットアップ完了。質問項目一覧は `docs/forms/hp-hearing-form.md` を参照。

**関連ファイル:**
- GAS: `docs/gas/hp/formCreator.js`
- 質問項目一覧: `docs/forms/hp-hearing-form.md`

##### STEP 2: ヒアリングシートのテンプレート設計（★次にやること）

**構成:**
- Part① 基本情報（フォームから自動転記）
- Part② ヒアリング情報（打ち合わせで記入）
- Part③ サーバー情報（フォームから転記 + 補足）★最重要
- Part④ 処理データ（システム管理）

##### STEP 3: GASの作成

**必要なGAS:**
1. `hearingSheetManager.js` - シート作成・フォーム転記
2. `createFolder.js` - 企業フォルダ作成
3. `settingsSheet.js` - 設定シート
4. `progressManager.js` - ステータス管理

**設計方針:** ツナゲルほど複雑にしない（不変・シンプル）

##### STEP 4: 残りのマニュアル作成（No.3〜10）

No.0〜2は完了済み。No.3以降を順次作成。

---

**現在のタスク構成（確定）:**
```
No.0  受注・立ち上げ（渡邉）
No.1  打ち合わせ前準備（河合）
No.2  初回打ち合わせ（渡邉, 河合）
No.3  文字起こし・転記（河合）
No.4  JSON出力・原稿生成（河合）
No.5  HP作成（河合）
No.6  素材撮影（川崎）※オプション
No.7  修正・根拠作成（河合）
No.8  MVP確認・修正（河合）
No.9  納品（河合）
No.10 月次FB（河合）
```

**マニュアルファイル（確定）:**
```
docs/manuals/hp/
├── 00-受注・立ち上げ.md
├── 01-打ち合わせ前準備.md
├── 02-初回打ち合わせ.md
├── 03-文字起こし・転記.md
├── 04-JSON出力・原稿生成.md
├── 05-HP作成.md
├── 06-素材撮影.md
├── 07-修正・根拠作成.md
├── 08-MVP確認・修正.md
├── 09-納品.md
└── 10-月次FB.md
```

---

#### 📋 次世代セッションでの作業

以下の作業を**順番に**進める。セッションが分かれても、このフローに従えばゴールに到達できる。

##### STEP 1: マニュアルの完璧化

各タスクのマニュアル（`docs/manuals/hp/XX-タスク名.md`）を実際に手を動かしながら完成させる。

**作業内容:**
1. 実際の業務を想定しながらマニュアルを詳細化
2. 操作画面のスクショを撮影
3. スクショをマニュアルに記載

**対象ファイル:** `docs/manuals/hp/` 内の11ファイル

##### STEP 2: インフォ（flowSteps）の詳細化

ツナゲルのように、hp.tsの各タスクのflowStepsに詳細情報を追加する。

**追加する情報:**
- `summary`: ステップの概要
- `description`: 詳細な手順説明
- `links`: 必要なリンク（スプレッドシート、フォルダ、外部ツール等）
- `images`: スクショ画像への参照

**参考:** `src/lib/data/tsunageru.ts` のflowSteps構造

##### STEP 3: GAS・テンプレートの調整

インフォ/マニュアル作成の過程で必要になったGASやテンプレートの調整を都度行う。

**調整対象:**
- GAS: 文字起こし転記、JSON出力など
- HPテンプレート: `/mnt/c/sing-hp-template/`

---

#### 🔄 作業フロー（セッション間共通）

セッションが分かれても、この順序で作業を進める:

```
1. マニュアル（md）を開く
   ↓
2. 実際の操作をしながら手順を詳細化
   ↓
3. スクショを撮影
   ↓
4. マニュアルにスクショを記載
   ↓
5. hp.tsのflowStepsに詳細情報を追加
   ↓
6. 必要に応じてGAS/テンプレートを調整
   ↓
7. 次のタスクへ（No.0から順番に）
```

**進捗管理:**
- 現在作業中のタスク番号をHANDOFFに記載
- 完了したタスクはチェックを入れる

---

#### 📊 進捗状況

| No | タスク名 | マニュアル | インフォ | 備考 |
|----|----------|------------|----------|------|
| 0 | 受注・立ち上げ | ✅ 完了 | ⬜ 骨格のみ | ツナゲルベース、画像付き |
| 1 | 打ち合わせ前準備 | ✅ 完了 | ⬜ 骨格のみ | ツナゲルベース、画像付き |
| 2 | 初回打ち合わせ | ✅ 完了 | ⬜ 骨格のみ | ツナゲルベース、画像付き |
| 3 | 文字起こし・転記 | ⬜ 未着手 | ⬜ 骨格のみ | |
| 4 | JSON出力・原稿生成 | ⬜ 未着手 | ⬜ 骨格のみ | |
| 5 | HP作成 | ⬜ 未着手 | ⬜ 骨格のみ | |
| 6 | 素材撮影 | ⬜ 未着手 | ⬜ 骨格のみ | オプション |
| 7 | 修正・根拠作成 | ⬜ 未着手 | ⬜ 骨格のみ | |
| 8 | MVP確認・修正 | ⬜ 未着手 | ⬜ 骨格のみ | |
| 9 | 納品 | ⬜ 未着手 | ⬜ 骨格のみ | |
| 10 | 月次FB | ⬜ 未着手 | ⬜ 骨格のみ | |

**凡例:** ⬜未着手 / 🔄作業中 / ✅完了

---

#### 設計思想

- **ツナゲルと同様のGAS＋AI活用フロー**
- **Canvaでのデザイン作成は廃止**（Claude Codeで直接実装）
- **「新人でもわかる」レベルの詳細化**

#### 素材撮影について

素材撮影は**オプション**（No.6）。

| パターン | 説明 |
|----------|------|
| A. 撮影あり（動画） | HPの中に動画を配置 |
| B. 撮影あり（写真） | 高解像度素材写真を配置 |
| C. 先方用意 | 先方に素材を用意してもらう |

#### 担当者情報（確定）

- 河合: メイン担当（ヒアリング〜納品〜月次FB）
- 川崎: 素材撮影
- 青柳: CC（全工程で報告を受ける）
- ※中尾はHP制作に関与しない

#### 関連リソース

- HPテンプレート: `/mnt/c/sing-hp-template/`
- 修正マニュアル: https://sing-hp-template.vercel.app/manual
- Googleフォーム質問項目: `docs/forms/hp-hearing-form.md`
- フォームGAS: `docs/gas/hp/formCreator.js`

---

#### 🔧 GAS調整作業（2026-01-30 開始）

HP制作用のGASを、ツナゲルのGASをベースに調整する。

**ツナゲルGASファイル構成:**
```
docs/gas/tsunageru/
├── commonStyles.js           # 共通スタイル定義（そのまま流用可能）
├── settingsSheet.js          # 設定シート管理
├── hearingSheetManager.js    # メイン（onOpen含む）シート作成
├── companyInfoManager.js     # 企業情報入力
├── promptDialog.js           # プロンプト生成
├── compositionDraftGenerator.js # 構成案作成
├── contactFormats.js         # 連絡フォーマット
├── progressManager.js        # 進捗管理
├── transcriptToHearingSheet.js  # 文字起こし転記
├── createShootingFolder.js   # フォルダ作成
├── companyCueGenerator.js    # 企業カンペ作成
└── sheetStructureChecker.js  # メンテナンス用
```

**HP制作で必要なGAS（優先順）:**
1. `hearingSheetManager.js` → シート作成・テンプレート
2. `createShootingFolder.js` → 企業フォルダ作成（素材フォルダはNo.6で別途）
3. `progressManager.js` → ステータス管理
4. `settingsSheet.js` → 設定シート
5. `contactFormats.js` → 連絡フォーマット
6. `transcriptToHearingSheet.js` → 文字起こし転記
7. `promptDialog.js` → JSON出力用プロンプト（HP制作固有）

**HP制作固有の機能:**
- テンプレート選択ダイアログ（No.4で使用）
- テンプレートに応じた素材フォルダ作成（No.6で使用）

**作業ステップ:**
1. ツナゲルGASの構造を理解
2. HP制作用にコピー・調整
3. HP固有機能を追加

**HP制作用GAS配置先:**
```
docs/gas/hp/
├── commonStyles.js           # ツナゲルと共通
├── settingsSheet.js
├── hearingSheetManager.js
├── createFolder.js           # フォルダ作成（親フォルダ＋素材フォルダ）
├── progressManager.js
├── contactFormats.js
├── transcriptToHearingSheet.js
└── jsonOutputDialog.js       # HP制作固有（テンプレート選択）
```

---

#### 📝 Googleフォーム・ヒアリングシート設計（2026-01-30 確定）

**設計方針:** ツナゲルほど複雑にしない（不変・シンプル）

---

##### セクション1: 基本情報

| # | 質問項目 | 形式 | 必須 |
|---|---------|------|------|
| 1 | 企業名 | テキスト | ○ |
| 2 | 担当者名 | テキスト | ○ |
| 3 | 役職 | テキスト | |
| 4 | 電話番号 | テキスト | ○ |
| 5 | メールアドレス | テキスト | ○ |

---

##### セクション2: HP制作の方向性

###### 2-1. HPの主な目的
**形式**: 複数選択 + その他（自由記述）

- [ ] 問い合わせ・見積依頼の増加
- [ ] 採用強化
- [ ] ブランディング・信頼性向上
- [ ] 情報発信（お知らせ・ブログ）
- [ ] EC・オンライン販売
- [ ] その他（自由記述）

###### 2-2. メインターゲット
**形式**: 複数選択 + その他（自由記述）

**顧客向け**
- [ ] 法人顧客
- [ ] 個人顧客
- [ ] 既存顧客

**求職者向け**
- [ ] 転職希望者（中途）
- [ ] 大学新卒
- [ ] 高校新卒

- [ ] その他（自由記述）

###### 2-3. 競合・意識している会社
**形式**: 任意テキスト（自由記述）

**ディスクリプション**:
```
同業他社や「このHPのようにしたい」と思う会社があれば教えてください
```

###### 2-4. 自社の強み・アピールポイント
**形式**: 選択式（複数選択可） + 自由記述

**ディスクリプション**:
```
お客様や取引先から評価されている点、他社と比べて自信のある点をお選びください。
HPでアピールするコンテンツの参考にさせていただきます。
```

**選択肢**:
- [ ] 技術力・品質
- [ ] 価格・コストパフォーマンス
- [ ] 対応スピード
- [ ] 実績・歴史
- [ ] 人材・社風
- [ ] 立地・アクセス
- [ ] その他

**自由記述欄**:
```
具体的な強みやエピソードがあれば教えてください（任意）
```

###### 2-5. 参考にしたいHP
**形式**: 自由記述（複数可）

**ディスクリプション**:
```
「このサイトの雰囲気が好き」「このレイアウトが見やすい」など、
参考にしたいサイトがあればURLを教えてください。

同業他社でなくても構いません。
良いと思うポイントも添えていただけると、より的確なご提案ができます。
```

###### 2-6. 現在のHP URL
**形式**: テキスト（任意）

**ディスクリプション**:
```
リニューアルの場合は現在のHPのURLを入力してください
```

###### 2-7. 現在のHPで気になっている点
**形式**: 複数選択 + その他（自由記述）

- [ ] デザインが古い
- [ ] スマホ対応していない
- [ ] 情報が更新できていない
- [ ] 問い合わせが少ない
- [ ] 検索で上位に出ない
- [ ] その他（自由記述）

###### 2-8. HP新規作成・リニューアルに期待すること
**形式**: 自由記述

**ディスクリプション**:
```
HPに期待することや実現したいことを自由にお書きください
```

###### 2-9. 必要なページ
**形式**: 複数選択 + その他（自由記述）

- [ ] トップページ
- [ ] 会社概要・企業情報
- [ ] サービス・事業内容
- [ ] 製品紹介
- [ ] 採用情報
- [ ] お問い合わせ
- [ ] お知らせ・ニュース
- [ ] ブログ・コラム
- [ ] アクセス・店舗情報
- [ ] よくある質問（FAQ）
- [ ] その他（自由記述）

###### 2-10. 既存素材の有無
**形式**: 複数選択

**ディスクリプション**:
```
HPに使用できる素材をお持ちかどうかをお選びください。
素材がない場合は撮影のご提案も可能です。
```

- [ ] ロゴデータ
- [ ] 会社・製品の写真
- [ ] 動画素材
- [ ] パンフレット・カタログ
- [ ] 素材はほぼない（撮影希望）

###### 2-11. SNSアカウント
**形式**: 任意テキスト

**ディスクリプション**:
```
連携・掲載したいSNSがあればURLを教えてください（Instagram、Facebook、X等）
```

###### 2-12. 希望公開時期
**形式**: 選択式

- 1ヶ月以内
- 3ヶ月以内
- 半年以内
- 特に決まっていない

---

##### セクション3: サーバー情報（★最重要）

###### ★★★ セクション冒頭の説明文（強調表示）★★★

```
【重要】このセクションは「把握状況の確認」です

ログイン情報やパスワードなどの入力は不要です。
「把握している」「把握していない」「わからない」のいずれかをお選びください。

把握していない項目があっても問題ありません。
打ち合わせ時に一緒に確認・整理していきます。
```

###### 3-1. サーバー管理の希望（★分岐の起点）

**ディスクリプション**:
```
どの選択肢が最適かわからない場合は「D. 検討中」をお選びください。
打ち合わせ時にメリット・デメリットをご説明します。
```

| 選択肢 | 説明 | 追加質問 |
|--------|------|---------|
| A. Singに移管する | ドメイン・サーバーをSingで管理 | 全項目 |
| B. メール契約だけ現行のまま残す | サーバー移管するがメールは現行維持 | 全項目（メール移行以外） |
| C. 自社で管理する | 納品物を渡して御社でアップロード | 最小限 |
| D. 検討中 | 打ち合わせで相談したい | 全項目（念のため） |

---

###### 【共通質問】全パターン共通

**3-2. 現在のドメイン**

**ディスクリプション**:
```
現在お使いのHP、または取得済みのドメインを入力してください。
例: example.co.jp、example.com
「https://」は不要です。
```

**3-3. プロバイダ（サーバー会社）**

**ディスクリプション**:
```
ドメインやサーバーを契約している会社です。
不明な場合は「不明・わからない」をお選びください。
```

**選択肢**:
- さくらインターネット
- Xserver（エックスサーバー）
- お名前.com
- ロリポップ
- AWS
- その他
- 不明・わからない

**3-4. 同じドメインでメールを使用していますか？**

**ディスクリプション**:
```
例: info@example.co.jp のように、HPと同じドメインのメールアドレスを
業務で使用しているかどうかをお答えください。

※メール使用中の場合、サーバー移管時に注意が必要です
```

**選択肢**:
- 使用している
- 使用していない
- 不明・わからない

---

###### 【A/B/D向け】追加質問

**3-5. プロバイダ管理画面のログイン情報**

**ディスクリプション**:
```
さくら、Xserver、お名前.comなどの管理画面にログインできる状態かどうかをお答えください。

※ここでIDやパスワードを入力する必要はありません
```

**選択肢**:
- 把握している（ログインできる）
- 把握していない（ログインできない・情報がない）
- 不明・わからない

**3-6. ドメイン管理画面のログイン情報**

**ディスクリプション**:
```
ドメインの設定変更ができる管理画面にログインできる状態かどうかをお答えください。
プロバイダ管理画面と同じ場合もあります。

※ここでIDやパスワードを入力する必要はありません
```

**選択肢**:
- 把握している（ログインできる）
- 把握していない（ログインできない・情報がない）
- 不明・わからない

**3-7. AuthCode（認証コード）の取得方法**

**ディスクリプション**:
```
AuthCode（オースコード）は、ドメインを別の会社に移管する際に必要なコードです。
取得方法を知っているかどうかをお答えください。

※わからなくても問題ありません。打ち合わせ時にご説明します。
```

**選択肢**:
- 把握している
- 把握していない
- わからない（AuthCode自体を知らない）

**3-8. DNS設定の確認方法**

**ディスクリプション**:
```
DNS設定とは、ドメインとサーバーを紐づける設定です。
現在の設定を確認できる状態かどうかをお答えください。

※わからなくても問題ありません。
```

**選択肢**:
- 把握している（確認できる）
- 把握していない
- わからない（DNS自体を知らない）

**3-9. 現在のサーバー管理者**

**ディスクリプション**:
```
現在、サーバーやドメインの管理を誰が行っているかをお答えください。
```

**選択肢**:
- 自社（社内担当者が管理）
- 外部委託（制作会社・IT業者等）
- 不明・わからない

**3-10. 外部委託先への連絡**

**ディスクリプション**:
```
外部に委託している場合、その委託先に連絡が取れる状態かどうかをお答えください。
```

**選択肢**:
- 連絡可能（連絡先を把握している）
- 連絡先不明（連絡が取れない可能性がある）
- 該当なし（外部委託していない）

**3-11. サブドメインの使用**

**ディスクリプション**:
```
サブドメインとは「shop.example.co.jp」「recruit.example.co.jp」のように、
メインドメインの前に文字列がついたドメインです。

別サービスや別サイトで使用している場合はお知らせください。
```

**選択肢**:
- 使用している
- 使用していない
- 不明・わからない

---

###### 【A/D向け】メール関連質問（メール使用中の場合のみ表示）

**3-12. メールアカウント数**

**ディスクリプション**:
```
同じドメインで使用しているメールアドレスの数をお答えください。
例: info@、sales@、tanaka@ で3アカウント
```

**選択肢**:
- 1〜5アカウント
- 6〜10アカウント
- 11アカウント以上
- 不明・わからない

**3-13. 過去メールの保持希望**

**ディスクリプション**:
```
サーバー移管時に、過去の送受信メールを新しい環境に移行するかどうかをお答えください。

※移行には追加作業が必要になる場合があります
```

**選択肢**:
- 保持したい（過去メールも移行希望）
- 不要（新しいメールだけでOK）
- 不明・わからない（相談したい）

**3-14. メールサーバーのログイン情報**

**ディスクリプション**:
```
メールソフト（Outlook等）の設定に使用するサーバー情報を把握しているかどうかをお答えください。
（受信サーバー、送信サーバー、ポート番号など）

※ここでIDやパスワードを入力する必要はありません
```

**選択肢**:
- 把握している
- 把握していない
- 不明・わからない

---

###### 【B向け】メール関連質問（メール使用中の場合のみ表示）

**3-12. メールアカウント数**（A/Dと同じ）

**ディスクリプション**:
```
同じドメインで使用しているメールアドレスの数をお答えください。
MXレコード設定の参考にさせていただきます。
例: info@、sales@、tanaka@ で3アカウント
```

※Bパターンではメール移行は不要（現行プロバイダでメール維持）、MXレコード設定のみ注意

---

###### 【C向け】追加質問（自社管理の場合のみ表示）

**3-15. FTPサーバー情報**

**ディスクリプション**:
```
FTPとは、サーバーにファイルをアップロードするための接続方法です。
FTP接続に必要な情報（ホスト名、ユーザー名、パスワード）を把握しているかどうかをお答えください。

※ここで接続情報を入力する必要はありません
```

**選択肢**:
- 把握している
- 把握していない
- 不明・わからない

**3-16. 現在のHPアップロード方法**

**ディスクリプション**:
```
現在のHPをどのような方法で更新・アップロードしているかをお答えください。
```

**選択肢**:
- FTP（FileZilla等のソフトを使用）
- CMS（WordPress等の管理画面から更新）
- 外部に依頼している
- 不明・わからない

※Cパターン: ビルド済みファイルを納品、先方がアップロード

---

###### ⚠️ 要注意パターン（打ち合わせで重点確認）

| パターン | 対応 |
|---------|------|
| ログイン情報がない | 外部委託先に連絡 or 再発行手続き |
| AuthCode取得方法がわからない | 打ち合わせで手順説明 |
| 同ドメインでメール使用中 + A選択 | メール移行計画が必須 |
| 過去メール保持希望 | IMAP移行の説明 |
| 外部連絡不可 | 移管困難、要相談 |
| 検討中 | 全パターン想定で情報収集 |

---

##### サーバー移管手順（お名前.com基準）

**パターンA: 完全移管（ドメインごと）**
```
1. 現在のDNS設定をスクショ/エクスポート
2. お名前.comでAuthCode（認証コード）を取得
3. 新レジストラ（Cloudflare等）で移管申請
4. DNS設定を再現（MXレコードは必ず維持）
5. 旧サーバーは1ヶ月程度維持（ロールバック用）
```

**パターンB: CNAMEのみ変更（ドメインはお名前.comのまま）**
```
1. お名前.comのDNS設定画面にアクセス
2. TTLを事前に短く（300秒程度）に変更
3. AレコードまたはCNAMEをVercelに向ける
4. MXレコードは絶対に変更しない
5. 浸透を待つ（数時間〜最大48時間）
```

**★不具合を避けるチェックリスト:**
- [ ] 現在のDNS設定を全て記録済み
- [ ] メールのMXレコードは変更しない
- [ ] 切り替え前にTTLを短くした
- [ ] 旧サーバーを一定期間維持できる
- [ ] ロールバック手順を用意した
- [ ] 切り替え日時を先方と合意した

---

##### デプロイパターン

| パターン | 条件 | 対応内容 |
|---------|------|---------|
| A. サーバー移管 | Singで完全管理希望 | ドメイン移管＋Vercelデプロイ |
| B. CNAMEのみ変更 | 既存サーバー維持、DNSだけ変更 | CNAME設定のみ |
| C. 先方アップロード | 納品物を渡す | ビルド済みファイル納品 |

##### ヒアリングシート構成（HP制作用）

**Part① 基本情報**（フォームから自動転記）
- 企業名、担当者、連絡先

**Part② ヒアリング情報**（打ち合わせで記入）
- HP制作の目的・背景
- ターゲット層
- 掲載コンテンツ
- デザインの方向性
- 参考サイト
- 撮影の有無

**Part③ サーバー情報**（フォームから自動転記 + 打ち合わせで補足）
- ドメイン
- プロバイダ
- サーバー管理者
- アップロード方法
- メール使用状況
- **デプロイパターン**（A/B/C）← 判断結果を記入

**Part④ 処理データ**（システム管理）
- 企業フォルダURL
- 素材フォルダURL
- 文字起こし原文
- 選択テンプレート

---

#### 📁 リソース・フォルダ設計（2026-01-30 確定）

##### HP制作用リソース

| リソース | URL |
|---------|-----|
| ヒアリングシート | https://docs.google.com/spreadsheets/d/1GO5fyOd-0lT_OMpLNw6rIZDRA6jrK4lzIAt-0tDxGvc/ |
| HP・LPフォルダ（親） | https://drive.google.com/drive/folders/1Zi2zn57JA3wZQvrEUwGN26jZkRDodWe- |
| ヒアリングシートフォルダ | https://drive.google.com/drive/folders/1ug4NtkTNB1Lvnw1GN9wtd07u8nXeBYTk |

##### ツナゲルとの関係

- **No.0〜2（初回打ち合わせまで）はツナゲルと同じフロー**
- 異なるのはリンク（ヒアリングシート、フォルダ）のみ
- グループ名: 【HP制作】○○株式会社

##### フォルダ構造

```
HP・LP フォルダ
├── ヒアリングシートフォルダ/
│   └── 各企業のヒアリングシート
└── 各企業フォルダ/（例: 株式会社竹内金型製作所）
    ├── 文字起こし原稿など
    └── 素材フォルダ/（テンプレートに応じたサブフォルダ構造）
        ├── aboutページフォルダ/
        ├── Companyページフォルダ/
        ├── RECRUITフォルダ/
        ├── Serviceページフォルダ/
        └── TOPページフォルダ/
            ├── 会社案内フォルダ/
            └── 設備フォルダ/
```

##### フォルダ作成タイミング

| タイミング | 作成するもの | 備考 |
|-----------|-------------|------|
| No.1 打ち合わせ前準備 | 企業フォルダ（親） | 文字起こし原稿等を格納 |
| No.6 素材撮影 | 素材フォルダ＋サブフォルダ | テンプレート確定後に作成 |

##### テンプレート選択の設計

```
No.3 文字起こし・転記
      ↓
No.4 JSON出力・原稿生成
      ↓ ダイアログでテンプレート選択
      ↓ 選択したテンプレートをヒアリングシートに保存
      ↓
No.6 素材撮影
      ↓ データ納品時にフォルダ作成
      ↓ ヒアリングシートからテンプレート情報を参照
      ↓ テンプレートに応じたサブフォルダ構造で作成
```

**設計ポイント:**
- テンプレート選択 → ヒアリングシートに保存（永続化）
- 素材フォルダ構造はテンプレートに依存（またはデフォルト構造）
- フォルダ作成時にヒアリングシートからテンプレート情報を参照

---

### ツナゲル検証・インフォ/マニュアル更新

新しいフローでの実際の検証を行い、スクショ撮影→インフォ更新→マニュアル更新を進める。

**作業開始前の確認事項:**
1. ガイドラインv3を熟読し、以下を理解する:
   - 意図・コンセプト・理念
   - KGI・要件
   - 設計思想
   - インフォ作成ルール
   - マニュアル作成ルール
2. 品質チェック項目を確認

**必読ドキュメント:**
- `docs/manual-creation-guideline-v3.md` ← 最重要

**作業内容:**
1. **No.0〜5**: 既存インフォ/マニュアルの更新（新フローでスクショ撮影）
2. **No.6〜13**: インフォ作成、フロー確定、実装（未着手業務）

**現状:**
- No.0〜5: インフォ/マニュアル作成済み（更新が必要な可能性）
- No.6〜13: 基本情報のみ、詳細フロー未確定

**インフォ/マニュアルファイル:**
```
docs/manuals/tsunageru/
├── 00-受注・立ち上げ.md
├── 01-打ち合わせ前準備.md
├── 02-初回打ち合わせ.md
├── 03-議事録作成.md
├── 04-構成案作成.md
├── 05-撮影準備.md
├── 06-撮影.md          ← ここから要実装
├── 07-動画編集.md
├── 08-原稿執筆.md
├── 09-求人原稿入稿.md
├── 10-確認依頼〜承認.md
├── 11-動画入稿・公開.md
├── 12-初回FB.md
└── 13-月次FB.md
```

---

## 📋 GAS最適化タスク（2026-01-14 作成・一部完了）

**レポート**: `docs/gas-optimization-report.md`

GASコードの最適化調査を実施。設計思想に沿った改善箇所を特定済み。

**完了した作業（2026-01-14）:**
- [x] 1-1. settingsSheet.js 4ダイアログのスタイル統一（CI_DIALOG_STYLES、CI_UI_COMPONENTS使用）
- [x] commonStyles.jsにbtn-add、btn-deleteを追加
- [x] 4ダイアログのサイズを700x750に統一
- [x] 3ダイアログに「※設定シートの○○列で手動でも変更可能です」を追加
- [x] 1-5. contactFormats.js 除外シート判定を`isExcludedSheet()`に統一
- [x] 1-5追加. `isExcludedSheet()`に「進捗管理」を追加
- [x] 1-7. createShootingFolder.js `SUBFOLDERS`定数削除（デッドコード）
- [x] 1-8. createShootingFolder.js `PARENT_FOLDER_ID`定数削除、フォールバックを`null`に
- [x] 1-4. companyInfoManager.js メンバー名を`settings['XXX'] || 'フォールバック'`パターンに
- [x] 1-6. contactFormats.js メンバー名を`settings['XXX'] || 'フォールバック'`パターンに

**保留中（設計検討が必要）:**
- 1-2. getInputKeyForPrompt() → 「将来の改善」セクション参照

**未着手:**
- 1-3（hearingSheetManager.js ステータス関連）

**作業時の必読ドキュメント**:
1. `docs/gas-optimization-report.md` - 具体的な問題箇所・改善方法
2. `docs/manual-creation-guideline-v3.md` - 設計思想・ルール

**設計原則（厳守）**:
- 設定値はハードコードせず、設定シートから`getXxx()`関数で取得
- スタイルはcommonStyles.jsの`CI_DIALOG_STYLES`、`CI_UI_COMPONENTS`を使用
- 「GAS」という表現は使わない → 「ヒアリングシートのメニュー」
- ダイアログサイズは700x750に統一

---

## 🚨 緊急引き継ぎ（2026-01-14 更新）

### flowStepsにステータス更新ステップを追加 - 完了

全14タスクのflowStepsの最後に「ステータス更新」ステップを追加。業務完了後、次の担当者へ引き継ぐためにステータスを更新する流れを明示化。

**追加内容:**
```typescript
{
  label: "ステータス更新",
  summary: "ヒアリングシートのメニューからステータスを更新",
  links: [
    { label: "ヒアリングシート", type: "link", url: "https://..." }
  ],
  description: `業務完了後、ヒアリングシートのステータス更新ダイアログで...`,
}
```

**表現ルール（非エンジニア向け）:**
- 「GAS」という表現は使わない → 「ヒアリングシートのメニュー」と記載
- 「メニュー」だけでは不十分 → 必ず「ヒアリングシートの」を付ける

**ガイドラインv3更新:**
- 3.5 表現ルール（非エンジニア向け）追加
- 3.6 ステータス更新ステップの追加
- 6.2 品質チェックに3項目追加

---

### 商材ページUIリファクタリング - 完了

「業務数」「課題感・改善ポイント一覧」「業務サマリー」をページ最下部に移動し、アコーディオン化。

**変更ファイル:**
- `src/components/Accordion.tsx` - 汎用アコーディオンコンポーネント新規作成
- `src/app/products/[id]/page.tsx` - 3セクションを最下部に移動、アコーディオン化

**変更前:** 上部にサマリー情報が表示
**変更後:** 業務詳細カードの後、footerの前にアコーディオンとして配置（デフォルト閉じ）

---

### タスク統合（15→14タスクに変更）- 完了

営業側タスク（No.0とNo.1）を統合し、14タスク（No.0〜13）に変更。

**変更前:** 15タスク（0.受注・ワークス立ち上げ / 1.日程調整 / 2.打ち合わせ前準備 / ...）
**変更後:** 14タスク（0.受注・立ち上げ / 1.打ち合わせ前準備 / 2.初回打ち合わせ / ...）

**変更ファイル:**
- `docs/manuals/tsunageru/` - 00と01を統合、02〜14を01〜13にリネーム
- `src/lib/data/tsunageru.ts` - taskCount: 13、タスク番号繰り上げ
- `docs/gas/tsunageru/progressManager.js` - getTasks()で設定シートから取得、PHASE_MAPPINGでphase付与
- `docs/gas/tsunageru/settingsSheet.js` - DEFAULT_TASKSを14タスクに
- `docs/gas/tsunageru/hearingSheetManager.js` - progressManager.jsのTASKSを参照（設定シート連携）

**タスク定義の一元化:**
- 設定シートD〜F列がマスター（getAllTaskAssignees()で取得）
- progressManager.jsのgetTasks()が設定シートから取得→phaseを付与
- hearingSheetManager.jsはprogressManager.jsのTASKSを参照
- タスク追加・変更時は設定シートを編集するだけでOK

**製作陣の役割変更:**
- グループ立ち上げを確認したら、各種対応が進んでいるかウォッチ
- 必要に応じて自ら対応（リマインド、日程調整の補助など）

---

### ステータス欄の修正（6項目）- 完了

#### 確定したステータス欄の構成

| 列 | 2行目（ヘッダー） | 3行目（入力） | 選択肢 |
|----|-----------------|--------------|--------|
| B | 現在タスク | ドロップダウン | 14段階（0.受注・立ち上げ〜13.月次FB） |
| C | タスク保持者 | ドロップダウン | 7名 |
| D | 状態 | ドロップダウン | 対応中 / 先方確認 / 次の担当へ |
| E | 期限 | 日付 | - |
| F | 最終更新日 | 自動 | - |
| G | 全体ステータス | ドロップダウン | 制作中 / 運用中 / 完了 |

#### 修正済みファイル

1. **hearingSheetManager.js**
   - `createStatusSection()` を6項目に修正
   - `setupTemplate()` の最初で `clearDataValidations()` 追加済み
   - `createLogHeader()` 追加（I〜N列にログヘッダー作成）

2. **progressManager.js**
   - `STATUS_COLUMNS` を6項目（B〜G列）に修正
   - `LOG_COLUMNS` 追加（I〜N列: ログエリア）
   - `STATUS_STATES` 追加（対応中 / 先方確認 / 次の担当へ）
   - `STATUS_OVERALL` 追加（制作中 / 運用中 / 完了）
   - `addStatusSection()` を6項目に修正
   - `getStatusFromSheet()` を6項目に対応
   - `hasStatusSection()` を修正
   - `updateSheetStatus()` を6項目に対応（最終更新日を自動更新 + ログ追加）
   - `createStatusUpdateHtml()` に状態・全体ステータス・メモを追加
   - `ensureLogHeader()` 追加（ログヘッダー作成）
   - `addUpdateLog()` 追加（ログ追加処理）
   - `calculateDuration()` 追加（工数計算）
   - 進捗一覧シートのヘッダーを8列に拡張
   - 条件付き書式に「先方確認」「完了」のルール追加

### ステータス更新ダイアログを全メニューに追加

全ての主要メニューの最後に「✏️ ステータス更新」を追加。どのメニューからでも `showStatusUpdateDialog()` を呼び出せる。

**追加したメニュー:**
- １.📋 企業情報入力（companyInfoManager.js）
- ２.📋 初回打ち合わせ（hearingSheetManager.js）
- ３.📝 議事録作成（promptDialog.js）
- ４.📝 構成案作成（compositionDraftGenerator.js）
- 📨 連絡フォーマット（contactFormats.js）
- ４.📝 文字起こし整理・転記（transcriptToHearingSheet.js）

### 更新ログ機能（I〜N列）

ステータス更新ダイアログから更新するたびに、I列〜N列にログが追記される。

**ログ構造:**
```
I1: 更新ログ（タイトル）
I2: 日時 / J2: タスク変更 / K2: 保持者変更 / L2: 状態 / M2: メモ / N2: 工数
I3: 1/14 15:30 / 3→4 / 渡邉→河合 / 対応中 / 確認依頼送付 / 2h
I4: 1/14 13:30 / 1→3 / - / 対応中 / 打ち合わせ完了 / 3d2h
...
```

**記録内容:**
- 日時: M/d HH:mm形式
- タスク変更: 番号のみ（3→4）、変更なしは「-」
- 保持者変更: 名前（渡邉→河合）、変更なしは「-」
- 状態: 対応中 / 先方確認 / 次の担当へ
- メモ: ダイアログで入力した任意テキスト
- 工数: 前回ログからの経過時間（自動計算）

### 作成したデバッグツール

- `docs/gas/tsunageru/sheetDumper.js` - シート構造をダンプ（値、背景色、列幅、ドロップダウン）

---

## 最近完了した機能（2026-01-14）

### 進捗管理機能（新規実装）

マネージャー（青柳CC）向けの進捗把握機能を追加。各企業プロジェクトの現在タスク・担当者・期限を一覧で確認可能。

**機能概要:**
1. **ステータス欄**: 各ヒアリングシートの2-3行目にステータス欄を追加（2行構成）
2. **進捗一覧シート**: 全企業のステータスを自動集約して一覧表示

**ヒアリングシート構造変更:**
```
1行目: 企業名（タイトル）
2行目: ステータスヘッダー（現在タスク / タスク保持者 / 状態 / 期限 / 最終更新日 / 全体ステータス）← B〜G列
3行目: ステータス入力欄（ドロップダウン / ドロップダウン / ドロップダウン / 日付 / 自動 / ドロップダウン）
4行目: Part① 基本情報
5行目〜: 企業概要など（従来より+1行ずれ）
```

**ステータス項目（6項目）:**
- 現在タスク: 0.受注・立ち上げ / 1.打ち合わせ前準備 / ... / 13.月次FB（14段階）
- タスク保持者: 渡邉 / 河合 / 川崎 / 中尾文香 / 紺谷 / 下脇田 / 先方
- 状態: 対応中 / 先方確認 / 次の担当へ
- 期限: 日付（任意）
- 最終更新日: 自動記録
- 全体ステータス: 制作中 / 運用中 / 完了

**進捗一覧シートの条件付き書式:**
- タスク保持者が「先方」→ 黄色背景
- 状態が「先方確認」→ 黄色背景
- 期限が過ぎている → 赤背景
- 全体ステータスが「完了」→ 緑背景

**GASメニュー:**
```
📊 進捗管理
├── 📋 進捗一覧シートを作成
├── 🔄 進捗一覧を更新
├── ─────────────
├── 📝 現在のシートにステータス欄を追加
├── 📝 全シートにステータス欄を追加
├── ─────────────
└── ✏️ ステータス更新
```

**関連ファイル（行番号+1対応済み）:**
- `docs/gas/tsunageru/progressManager.js` - 進捗管理機能（新規）
- `docs/gas/tsunageru/hearingSheetManager.js` - FORM_TO_SHEET_MAPPING行番号+1
- `docs/gas/tsunageru/compositionDraftGenerator.js` - PART1/PART2_MAPPING行番号+1
- `docs/gas/tsunageru/transcriptToHearingSheet.js` - TRANSCRIPT_TO_SHEET_MAPPING行番号+1
- `docs/gas/tsunageru/createShootingFolder.js` - getRange(6, 3)に変更
- `docs/gas/tsunageru/companyInfoManager.js` - getRange(6, 3)に変更
- `docs/gas/tsunageru/promptDialog.js` - getRange(6, 3)に変更

---

### フローステップタイトル改善・UI微調整（完了）

**タイトル改善:**
1. タイトルを簡潔化（例: 「ワークスで企業グループを作成」→「グループ作成」）
2. summaryに詳細説明を追加（例: 「LINEWORKSで企業グループを立ち上げる」）
3. ボタンの絵文字（📄📋）を削除

**共通化されたタイトル例:**
- 日程調整、カレンダー登録、ワークス共有、リアクション確認
- シート作成、フォルダ作成、議事録作成、構成案作成
- NOTTA起動、NOTTA確認、すり合わせ
- 撮影連絡、撮影、データチェック、動画編集
- 確認依頼、承認取得、FB実施、FB日程確定

**UI微調整:**
- カード幅: w-32(128px) → w-40(160px)
- カード間余白: gap-2 → gap-1
- カード内余白: px-3 → px-2.5
- ボタン横幅: 統一（w-full + justify-center）
- タイトル左余白: ml-1追加
- メインコンテンツ左右余白: px-4/8/12 → px-3/6/8

**関連ファイル:**
- `src/components/TaskCard.tsx` - カード・ボタンスタイル調整
- `src/lib/data/tsunageru.ts` - 全15タスクのflowSteps改善
- `src/app/products/[id]/page.tsx` - 左右余白調整

---

### フローステップのデザイン改善（完了）

**変更内容:**
```
【PC】横並び折り返し、固定幅
┌──────┐  ▶  ┌──────┐  ▶  ┌──────┐
│ ① ラベル│     │ ② ラベル│     │ ③ ラベル│
│ summary │     │ summary │     │ summary │
│ [ボタン]│     │ [ボタン]│     │ [ボタン]│
└──────┘     └──────┘     └──────┘

【モバイル】縦並び、コンテナ幅いっぱい
┌────────────────────────┐
│ ① ラベル / summary / [ボタン] │
└────────────────────────┘
              ▼
┌────────────────────────┐
│ ② ラベル / summary / [ボタン] │
└────────────────────────┘
```

**実装詳細:**
- `FlowStep`型に`summary`フィールド追加
- PC: 固定幅（w-40 = 160px）、横並び折り返し
- モバイル: コンテナ幅いっぱい（w-full）、縦並び
- 高さ: min-h-[120px]
- ステップ番号を左上に丸バッジで表示
- 矢印: 丸の中にChevronRight/ChevronDown（リッチなデザイン）
- `hasFlowSteps`未使用変数削除

### モバイルハンバーガーメニュー（完了）

**変更内容:**
- ヘッダーにハンバーガーアイコン追加（モバイルのみ）
- Menu ↔ X の回転アニメーション
- `ProductPageLayout`にヘッダーを統合
- Sidebarの開くボタンはデスクトップのみ表示（`hidden lg:block`）
- モバイルではデフォルトでメニュー閉じ

**関連ファイル:**
- `src/components/ProductPageLayout.tsx` - ヘッダー統合、ハンバーガーメニュー
- `src/components/Sidebar.tsx` - 開くボタンをデスクトップのみに
- `src/app/products/[id]/page.tsx` - ヘッダー削除（ProductPageLayoutに移動）

---

## プロジェクト概要

制作陣の業務効率化とマニュアル整備プロジェクト。
9商材・52業務を対象に、AI活用による効率化とマニュアル改善を推進。

**ガイドライン**:
- `docs/manual-creation-guideline-v3.md` ★最新版（新商材作成の完全ガイド）
- `docs/manual-creation-guideline-v2.md` UI仕様詳細（GASダイアログコンポーネント）
- `docs/manual-creation-guideline.md` 旧版（データ構造・型定義の参照用）

---

## 設計思想

### スプレッドシート中心の設計
本体はスプレッドシート+GAS。Next.jsサイトは補助（閲覧用ビュー）。

**理由**: 担当者が直接メンテナンスできる。コード変更不要。

### GASの2つの機能
- **AIプロンプト生成**: データ+プロンプト → AIに貼り付け → AI出力を使う
- **フォーマット生成**: データ+テンプレート → そのまま使える定型文

### 基本セット構成
- プロンプトシート（AIプロンプト管理）
- 設定シート（担当者名等の設定値）
- フォーム連携時: 回答シート + 原本シート

### 入力データの永続化
ダイアログで入力したデータは一時的ではなく、スプレッドシートに保存して再利用する。

**フロー:**
1. 貼り付け → 対象シートのセルに保存
2. 次回開く → セルから読み込み → フィールドに自動入力
3. 後続フローでも同じデータを参照可能

---

## 商材別業務一覧

| 商材 | 業務数 | 進捗 |
|------|--------|------|
| ツナゲル | 14 | GAS実装済み |
| バツグン | 5 | 基本情報のみ |
| HP制作 | 8 | 基本情報のみ |
| LP制作 | 5 | 基本情報のみ |
| SNS広告 | 5 | 基本情報のみ |
| PV制作 | 5 | 基本情報のみ |
| パンフ | 3 | 基本情報のみ |
| ロゴ | 3 | 基本情報のみ |
| 月刊Sing | 4 | 基本情報のみ |
| **合計** | **52** | - |

---

## GASメニュー構成（ツナゲル）

```
０.⚙️ 設定
├── 👥 メンバー編集
├── 📝 業務担当者編集
├── 📁 フォルダ設定編集
├── ─────────────
├── 📄 プロンプト編集
├── ─────────────
├── 📋 設定シートを作成
├── 📝 プロンプトシートを作成
└── 📊 企業情報一覧を作成

１.📋 企業情報入力
├── 📥 企業情報入力（ワークス貼り付け）
├── 📢 受注・キックオフ連絡
├── 📩 先方へ日程調整・フォーム記入依頼メール
├── ─────────────
├── 🏢 企業情報編集
├── ─────────────
└── 📊 企業情報一覧反映

２.📋 初回打ち合わせ
├── 🆕 新規ヒアリングシート作成（フォーム回答から）
├── 🆕 新規ヒアリングシート作成（手動）
├── ─────────────
├── 📂 新規フォルダ作成（企業シートから）
├── 🆕 新規フォルダ作成（手動）
├── ─────────────
├── 📥 フォーム回答を既存シートに転記
├── ─────────────
├── 📋 最近作成した企業フォルダ一覧
├── ─────────────
├── 🎨 テンプレート初期設定
└── ⚙️ 親フォルダを設定

３.📝 議事録作成
├── （プロンプトシートから動的生成）
├── ─────────────
├── 📋 文字起こしを整理（プロンプト生成）
├── 📥 AI出力を転記
├── ─────────────
├── 📄 プロンプトシートを作成
├── 🔄 サンプルプロンプトを追加
└── ❓ 使い方

４.📝 構成案作成
├── 📋 構成案を作成（プロンプト生成）
├── ─────────────
├── 📤 ペアソナ/エンゲージ形式に変換
├── 📤 ワークス報告用に変換
├── 📤 撮影指示書に変換
├── ─────────────
├── 📸 撮影日程確定報告
├── ─────────────
└── 🔧 シートデータ確認

📨 連絡フォーマット
├── 📋 日程確定報告
├── ─────────────
├── 📷 撮影日程確認
├── 🔔 参加者リマインド
├── ─────────────
├── 🎬 撮影指示連絡
├── 📸 撮影日程確定報告
└── 📝 議事録共有

📊 進捗管理
├── 📋 進捗一覧シートを作成
├── 🔄 進捗一覧を更新
├── ─────────────
├── 📝 現在のシートにステータス欄を追加
├── 📝 全シートにステータス欄を追加
├── ─────────────
├── ✏️ ステータス更新
└── 📝 進捗ログを追加
```

---

## GASファイル構成

```
docs/gas/tsunageru/
├── commonStyles.js           # ★共通スタイル定義
├── settingsSheet.js          # 0.設定シート管理
├── hearingSheetManager.js    # メイン（onOpen含む）2.初回打ち合わせ
├── companyInfoManager.js     # 1.企業情報入力
├── promptDialog.js           # 3.議事録作成
├── compositionDraftGenerator.js # 4.構成案作成
├── contactFormats.js         # 連絡フォーマット
├── progressManager.js        # 📊進捗管理（新規）
├── transcriptToHearingSheet.js  # 文字起こし転記（3に統合）
├── createShootingFolder.js   # 撮影フォルダ作成（2に統合）
├── companyCueGenerator.js    # 企業カンペ作成
└── sheetStructureChecker.js  # メンテナンス用
```

---

## Next.jsサイト共通化（src/lib/data/common/）

商材共通のマニュアル・テンプレートを切り出し、tsunageru.ts等から参照する構成。

```
src/lib/data/common/
├── index.ts
├── manuals/
│   ├── index.ts
│   ├── gas-auth.ts           # GAS認証フロー説明
│   ├── notta.ts              # NOTTA使い方（起動・終了・準備確認）
│   └── works-reaction.ts     # ワークスリアクションルール
└── templates/
    ├── index.ts
    ├── order-notification.ts     # 受注連絡（商材名を引数で渡す）
    ├── schedule-confirm.ts       # 日程確定報告
    ├── reminder.ts               # リマインド
    ├── shooting-request.ts       # 撮影日程確認
    ├── shooting-instruction.ts   # 撮影指示
    ├── minutes-share.ts          # 議事録共有
    ├── fb-report.ts              # FB報告テンプレート（3商材共通）
    └── shooting-checklist.ts     # 撮影時チェックリスト（2商材共通）
```

**テンプレート関数の使い方:**
```typescript
// 商材名を渡すだけで使える
createOrderNotificationTemplate("ツナゲル", "12ヶ月")
createOrderNotificationTemplate("HP制作", "制作")

// 引数なしで呼び出し
createScheduleConfirmTemplate()
createReminderTemplate()

// 定数として直接参照（Task.formatで使用）
format: FB_REPORT_TEMPLATE,      // ツナゲル/バツグン/HP共通
format: SHOOTING_CHECKLIST,      // ツナゲル/バツグン共通
```

---

## ヒアリングシート構成

### Part① 基本情報（フォーム回答から自動転記）
企業名、担当者名、業種、所在地、従業員数など

### Part② ヒアリング情報（打ち合わせ時記入）
- 会社紹介（私たちについて、社長挨拶、会社の魅力、雰囲気）
- 社員の声（最低2名）
- 求人写真
- 重要セクション（★★★）
- 募集情報
- 管理情報
- スカウトメール設定
- **撮影準備**（撮影場所、駐車場、当日担当者、緊急連絡先、必要備品、撮影日時、集合時間）

### Part③ 処理データ（システム管理）
- 撮影素材フォルダURL
- メインフォルダURL
- 文字起こし原文
- 議事録
- 構成案
- ペアソナ/エンゲージ
- 撮影指示書
- 企業カンペURL

---

## 設定シート構成

| 列 | 内容 |
|----|------|
| A-B列 | メンバー一覧 |
| D-F列 | 業務担当者 |
| H-I列 | フォルダ設定 |
| K列 | 企業情報項目 |
| M-N列 | 保存キーマッピング（プロンプト名→Part③保存先） |
| P-Q列 | Part③構成（ラベル名、行数） |

---

## 確定UI一覧

| 項目 | 仕様 |
|------|------|
| ダイアログ横幅 | 700px |
| ダイアログ高さ | 750px（基本値） |
| 担当者選択 | コンパクトドロップダウン |
| 企業選択 | カスタムドロップダウン（チェック・ハイライト・アクティブバッジ） |
| テンプレート表示 | 白背景+枠線、コピーボタンはタイトル行右端 |
| プレビューUI | カード形式、緑コピーボタン |

---

## ワークスのスタンプルール

| ルール | 説明 |
|--------|------|
| ①完了していないならスタンプを押さない | スタンプ = 完了の意思表示 |
| ②5分以上かかるものはタスク・カレンダーに落とし込んでからスタンプ | すぐ対応できないものは先にタスク化 |
| ③既読したらOKスタンプ → 完了したらグッドスタンプに変更 | 👌（OK）= 確認した、対応中 / 👍（グッド）= 完了した |

---

## 撮影関連情報フロー

```
① 日程調整メール
   └→ 「撮影日程を打ち合わせ時に決められれば」+ インタビュイー確認依頼

② 初回打ち合わせ
   └→ 撮影場所、駐車場、当日担当者、緊急連絡先等を聞く

③ 議事録プロンプト
   └→ AIが文字起こしから撮影関連情報も抽出して出力

④ 文字起こし→ヒアリングシート転記
   └→ Part②に自動転記

⑤ 撮影日程確定報告ダイアログ
   └→ Part②から自動読み込み
```

---

## マニュアルのmd分離（実装中）

tsunageru.tsの`manualDraft`をmdファイルに分離し、メンテナンス性を向上させる。

**ファイル配置:**
```
docs/manuals/
├── common/          # 共通マニュアル（複数商材で共有）
│   └── *.md
└── tsunageru/       # 商材固有マニュアル
    ├── 00-受注・ワークス立ち上げ.md
    ├── 01-初回打ち合わせ日程調整.md
    ...
    └── 14-月次FB打合せ.md
```

**読み込み関数:**
- `getManualByTaskNo(productId, taskNo)` → 商材固有マニュアル
- `getCommonManual(name)` → 共通マニュアル

**URL:**
- 商材固有: `/products/{productId}/tasks/{taskNo}/manual`
- 共通: `/manuals/common/{name}`

**移行済み共通マニュアル:**
- `/manuals/common/notta` ← 旧 `/manuals/notta` から移行

**使用パッケージ:**（インストール済み）
```bash
npm install react-markdown remark-gfm rehype-raw
```

**実装済み:**
- [x] パッケージインストール
- [x] ディレクトリ作成（docs/manuals/tsunageru/）
- [x] lib/manuals.ts作成（md読み込み関数）
- [x] ManualMarkdownRenderer.tsx作成（Client Component）
- [x] manual/page.tsx改修（Server Component方式）

**アーキテクチャ:** Server Component方式（ベストプラクティス）
```
manual/page.tsx (Server Component)
    ↓ getManualByTaskNo() で fs.readFile
    ↓ content を props で渡す
ManualMarkdownRenderer (Client Component)
    ↓ react-markdown でレンダリング
```

**残タスク:**
- [x] ~~マークダウンスタイル問題の修正~~ ✅完了
- [x] ~~全15タスクのmdファイル作成（No.0〜14）~~ ✅2026-01-13完了
- [x] ~~tsunageru.tsの`manualDraft`削除~~ ✅2026-01-13完了

**マニュアルmd分離: 完了**

---

## フロー・ガイドラインのmd分離（2026-01-13完了）

tsunageru.tsの`overallFlow`, `detailedFlow`, `memo`, `format`（ガイドライン）を外部mdファイルに分離。

**ファイル配置:**
```
docs/
├── flows/tsunageru/        # フロー
│   ├── overall-flow.md     # ← Task 5 overallFlow
│   ├── feedback-flow.md    # ← Task 14 memo
│   └── monthly-fb-flow.md  # ← Task 14 detailedFlow
└── guidelines/tsunageru/   # ガイドライン
    └── job-posting-guideline.md  # ← Task 9 format（差別化求人原稿ガイドライン）
```

**読み込み関数:**（lib/manuals.ts）
- `getFlow(productId, flowName)` → フロー読み込み
- `getGuideline(productId, guidelineName)` → ガイドライン読み込み

**UI対応:**
- `overall-flow/page.tsx` → Server Component化、mdファイル読み込み対応
- `flow/page.tsx` → Server Component化、mdファイル読み込み対応

**削減効果:**
- tsunageru.ts: 2,438行 → 1,825行（613行削減）

**フロー・ガイドラインmd分離: 完了**

---

## サイドメニュー実装（2026-01-13完了）

商材ページ（`/products/[id]`）に開閉式サイドメニューを実装。

**機能:**
- 全体フロー（商材レベル）へのリンク
- タスク一覧（アンカースクロール）
- マニュアル一覧（別タブで開く）
- フォーマット一覧（モーダル表示）

**コンポーネント構成:**
```
src/components/
├── Sidebar.tsx           # サイドメニュー本体
├── SidebarSection.tsx    # アコーディオンセクション
└── ProductPageLayout.tsx # 2カラムレイアウト管理
```

**特徴:**
- デスクトップ: 固定幅（w-64）、左右スライド式
- モバイル: 画面幅いっぱい、背景透過（95%）、スクロール後に自動閉じ
- lucide-reactでアイコン統一

**全体フローの配置変更:**
- 以前: Task 5に`hasOverallFlow`を設定
- 現在: 商材レベル（Product型）に`hasOverallFlow`を設定
- URL: `/products/{productId}/overall-flow`

**関連ファイル:**
- `src/app/products/[id]/page.tsx` - 2カラムレイアウト、ヘッダー改修
- `src/app/products/[id]/overall-flow/page.tsx` - 商材レベル全体フローページ
- `src/lib/data/index.ts` - Product型に`hasOverallFlow`追加

---

## ボタン表示問題の解決（2026-01-13完了）

**問題:**
md分離後、TaskCardの「マニュアル」「全体フロー」「詳細フロー」ボタンが表示されなかった。

**原因:**
`hasAnyDetail`変数が`manualDraft`, `overallFlow`, `detailedFlow`の存在をチェックしていたが、`hasManual`, `hasOverallFlow`, `hasDetailedFlow`フラグをチェックしていなかった。

**修正内容:**（TaskCard.tsx）
```typescript
// 修正前
const hasAnyDetail =
  task.manualDraft ||
  task.overallFlow ||
  task.detailedFlow || ...

// 修正後
const hasAnyDetail =
  task.manualDraft || task.hasManual ||
  task.overallFlow || task.hasOverallFlow ||
  task.detailedFlow || task.hasDetailedFlow || ...

// マニュアルボタン条件も修正
{(task.manualDraft || task.hasManual) && (...)}
```

---

## モバイル対応（2026-01-13完了）

商材ページとTaskCardのレスポンシブ対応を実装。

**対応内容:**
- ヘッダー: アイコン・タイトルサイズ調整、descriptionはmd以上で表示
- サイドメニュー: モバイルでは画面幅いっぱい、背景透過、スクロール後自動閉じ
- TaskCardヘッダー: モバイルでは縦並びレイアウト
- フローステップ: モバイルでは縦並び、矢印は「↓」に変更
- 余白: モバイルでは小さめに調整

---

## 使用パッケージ

```bash
# マークダウンレンダリング
npm install react-markdown remark-gfm rehype-raw

# アイコン
npm install lucide-react
```

---

## 将来の改善

### プロンプトの入力キー・保存キー管理

現在`getInputKeyForPrompt()`は`DEFAULT_SAVE_KEY_MAPPING`（ハードコード）から取得している。プロンプトシートで管理するように改善する。

**背景:**
- 各プロンプトには「入力キー」（Part③のどのラベルから入力を取得するか）と「保存キー」（Part③のどのラベルに出力を保存するか）が必要
- 現在は一部のプロンプトのみハードコードで定義
- すべてのプロンプトで設定可能にすべき

**対象プロンプト:**
- 議事録作成 → 入力:文字起こし原文 / 保存:議事録
- ヒアリング情報抽出 → 入力:文字起こし原文 / 保存:ヒアリング抽出JSON
- 構成案作成 → 入力:議事録 / 保存:構成案
- ペアソナ/エンゲージ変換 → 入力:構成案 / 保存:ペアソナ/エンゲージ
- ワークス報告変換 → 入力:構成案 / 保存:（なし？）
- 撮影指示書変換 → 入力:構成案 / 保存:撮影指示書

**設計検討事項:**
1. プロンプトシートに「入力キー」「保存キー」列を追加する案
2. プロンプト編集ダイアログで設定できるようにする
3. `getInputKeyForPrompt()` / `getSaveKeyForPrompt()` をプロンプトシートから取得するように変更

**関連ファイル:**
- `docs/gas/tsunageru/settingsSheet.js` - `getInputKeyForPrompt()`, `DEFAULT_SAVE_KEY_MAPPING`
- `docs/gas/tsunageru/promptDialog.js` - プロンプト編集ダイアログ

---

### 「各種フォーマット」シートの作成
メールテンプレートなどのフォーマットを「各種フォーマット」シートから取得するように改善する。

**実装タスク:**
1. 設定メニューに「📋 各種フォーマットシートを作成」「📝 各種フォーマット編集」を追加
2. `initializeFormatSheet()` - 各種フォーマットシート作成関数
3. `showFormatEditDialog()` - 各種フォーマット編集ダイアログ
4. `getFormatFromSheet(formatName)` - フォーマット取得関数

---

## 開発コマンド

```bash
npx tsc --noEmit    # TypeScriptエラーチェック（コード変更後は必ず実行）
```

---

## 担当者一覧（ツナゲル）

| 担当者 | 色 | 主な業務 |
|--------|-----|---------|
| 渡邉 | グレー | 受注・立ち上げ、日程調整 |
| 河合 | ピンク | 打ち合わせ、原稿、編集 |
| 中尾文香 | 黄色 | 原稿執筆 |
| 川崎 | 水色 | 企画、撮影、FB |
| 下脇田 | 紫 | FB |
| 紺谷 | オレンジ | 応募対応 |

---

## 更新履歴

| 日付 | 内容 |
|------|------|
| 2026-01-30 | HP制作: Googleフォーム作成完了（GASでセットアップ、質問項目一覧をdocs/forms/に保存） |
| 2026-01-30 | HP制作: Googleフォーム設計完了（サーバー情報の条件分岐質問、4パターン対応） |
| 2026-01-30 | HP制作: サーバー移管手順を整理（お名前.com基準、メール維持パターン含む） |
| 2026-01-30 | HP制作: No.0〜2マニュアル完成（ツナゲルベース、画像付き、HP制作用にカスタマイズ） |
| 2026-01-30 | HP制作: リソース・フォルダ設計を追加（ヒアリングシートURL、フォルダ構造、テンプレート選択タイミング） |
| 2026-01-14 | GAS最適化: settingsSheet.js 4ダイアログにCI_DIALOG_STYLES/CI_UI_COMPONENTS適用、サイズ700x750統一、手動変更可能の説明追加 |
| 2026-01-14 | GAS最適化: commonStyles.jsにbtn-add、btn-delete追加 |
| 2026-01-14 | GAS最適化レポート作成（docs/gas-optimization-report.md）、将来改善に入力キー・保存キー管理を追加 |
| 2026-01-14 | 全14タスクのflowStepsに「ステータス更新」ステップを追加、表現ルール統一（GAS→ヒアリングシートのメニュー） |
| 2026-01-14 | ガイドラインv3更新（表現ルール、ステータス更新ステップ追加、品質チェック項目追加） |
| 2026-01-14 | 商材ページUI改善: 業務数・課題・サマリーを最下部に移動してアコーディオン化、Accordion.tsx新規作成 |
| 2026-01-14 | タスク定義を設定シートから取得するように変更（progressManager.js→getTasks()、hearingSheetManager.js連携） |
| 2026-01-14 | タスク統合（15→14タスク）: No.0とNo.1を統合、マニュアル・tsunageru.ts・GAS更新 |
| 2026-01-14 | ステータス更新ダイアログを全メニューに追加（企業情報入力、初回打ち合わせ、議事録作成、構成案作成、連絡フォーマット） |
| 2026-01-14 | 更新ログ機能追加（I〜N列、タスク変更・保持者変更・状態・メモ・工数を記録） |
| 2026-01-14 | ステータス欄を6項目に拡張（状態・全体ステータス追加、条件付き書式追加） |
| 2026-01-14 | 進捗管理機能実装（progressManager.js、ステータス管理・進捗一覧・進捗ログ） |
| 2026-01-14 | フローステップUI微調整（カード幅w-40、余白調整、ボタン統一、タイトル左余白ml-1） |
| 2026-01-14 | フローステップタイトル改善（タイトル簡潔化、summary追加、ボタン絵文字削除） |
| 2026-01-14 | モバイルハンバーガーメニュー実装（ProductPageLayoutにヘッダー統合、Menu↔Xアニメーション） |
| 2026-01-14 | フローステップデザイン完了（FlowStep.summary追加、ステップ番号バッジ、丸枠矢印、サイズ統一） |
| 2026-01-13 | フローステップデザイン改善（途中）: Task型にsummary追加、lucide-react矢印導入 |
| 2026-01-13 | ガイドラインV3作成（新商材作成の完全ガイド、設計思想・共通概念・ルール・作り方） |
| 2026-01-13 | フォーマット共通化（FB_REPORT_TEMPLATE, SHOOTING_CHECKLIST）3商材で共有 |
| 2026-01-13 | モバイル対応（ヘッダー、サイドメニュー、TaskCard、フローステップ） |
| 2026-01-13 | サイドメニュー実装（Sidebar.tsx、SidebarSection.tsx、ProductPageLayout.tsx） |
| 2026-01-13 | 全体フローを商材レベルに移動（/products/{id}/overall-flow） |
| 2026-01-13 | lucide-reactインストール、アイコン統一 |
| 2026-01-13 | ボタン表示問題解決（hasAnyDetailにフラグ追加、マニュアルボタン条件修正） |
| 2026-01-13 | フロー・ガイドラインmd分離完了（docs/flows/, docs/guidelines/、613行削減） |
| 2026-01-13 | tsunageru.tsのmanualDraft全削除完了（md分離作業完了） |
| 2026-01-13 | 全14タスクのmdファイル作成完了（docs/manuals/tsunageru/に00〜13のマニュアル） |
| 2026-01-13 | マークダウンスタイル問題修正（globals.css、ManualMarkdownRenderer.tsx更新、engineer-course準拠） |
| 2026-01-13 | マニュアルmd分離実装（Server Component方式に変更、lib/manuals.ts、ManualMarkdownRenderer.tsx） |
| 2026-01-13 | マニュアルmd分離の設計決定（react-markdown + rehype-raw、HTML埋め込み対応） |
| 2026-01-13 | Next.jsサイト共通化（common/manuals, common/templates）、ワークススタンプルール追加 |
| 2026-01-13 | 撮影関連情報フロー実装、日程調整メール更新、GASメニュー名変更 |
| 2026-01-13 | 企業カンペ機能実装（3シート構成、5列化、チェックボックス） |
| 2026-01-13 | 撮影日程確定報告ダイアログ実装 |
| 2026-01-12 | Part③構成を設定シートで管理、保存機能追加 |
| 2026-01-12 | 全ダイアログをドロップダウンUI形式に統一 |
| 2026-01-12 | プロンプトシートにカテゴリ列追加 |
| 2026-01-11 | 企業選択UI共通化、commonStyles.js作成 |
| 2026-01-11 | GASメニュー構成変更、companyInfoManager.js新規作成 |
| 2026-01-10 | 入力データの永続化（Part③）、撮影フォルダ作成改善 |
| 2026-01-10 | settingsSheet.js作成、contactFormats.js作成 |
