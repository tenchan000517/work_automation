# 業務効率化・マニュアル作成プロジェクト HANDOFF

## プロジェクト概要

制作陣の業務効率化とマニュアル整備プロジェクト。
9商材・52業務を対象に、AI活用による効率化とマニュアル改善を推進。

**ガイドライン**: `docs/manual-creation-guideline.md` を参照

---

## 設計思想

### スプレッドシート中心の設計
本体はスプレッドシート+GAS。Next.jsサイトは補助（閲覧用ビュー）。

**理由**: 担当者が直接メンテナンスできる。コード変更不要。

### GASの2つの機能
- **AIプロンプト生成**: データ+プロンプト → AIに貼り付け → AI出力を使う
- **フォーマット生成**: データ+テンプレート → そのまま使える定型文

### 基本セット構成
- プロンプトシート（AIプロンプト管理）
- 設定シート（担当者名等の設定値）
- フォーム連携時: 回答シート + 原本シート

**理由**: この構成なら新商材追加時も同じパターンで対応可能。

### GASダイアログとNext.js popupのUI統一
GASダイアログとNext.jsのオレンジボタン（popup）は同じ機能・同じUIにする。

**理由**:
- 開発時に片方を見れば両方わかる
- 設計が統一され、保守が楽
- ユーザー体験が一貫する

**UI仕様**: ガイドラインの「ダイアログUI仕様」を参照

### 入力データの永続化
ダイアログで入力したデータは一時的ではなく、スプレッドシートに保存して再利用する。

**フロー:**
1. 貼り付け → 対象シートのセルに保存
2. 次回開く → セルから読み込み → フィールドに自動入力
3. 後続フローでも同じデータを参照可能

**上書き時の挙動:**
- 既にデータがある状態で新規入力 → 「上書きしますか？」アラート
- OK → 上書き保存

**除外シート（対象シート選択肢に出さない）:**
- プロンプト
- 設定
- フォームの回答1
- ヒアリングシート（原本/テンプレート）

これらはシステムシートなので、企業データ保存先として選択不可。

---

## 商材別業務一覧

| 商材 | 業務数 | 進捗 |
|------|--------|------|
| ツナゲル | 14 | 配列順0〜5を新形式に移行済み |
| バツグン | 5 | 基本情報のみ |
| HP制作 | 8 | 基本情報のみ |
| LP制作 | 5 | 基本情報のみ |
| SNS広告 | 5 | 基本情報のみ |
| PV制作 | 5 | 基本情報のみ |
| パンフ | 3 | 基本情報のみ |
| ロゴ | 3 | 基本情報のみ |
| 月刊Sing | 4 | 基本情報のみ |
| **合計** | **52** | - |

---

## 完了済み機能

### システム基盤
- Next.js 16 + TypeScript + Tailwind CSS v4
- 商材別データ分割管理（`src/lib/data/*.ts`）
- 担当者別色分け表示
- 複数入力フィールド対応（InputFieldConfig）

### ツナゲル業務フロー
- 配列順0〜5: flowSteps + 複数入力フィールド対応
- GAS連携: ヒアリングシート管理、構成案生成、撮影フォルダ作成

### GASスクリプト
- `settingsSheet.js`: 設定シート管理（単独ファイル）★新規
- `hearingSheetManager.js`: ヒアリングシート統合管理（onOpen含む）
- `transcriptToHearingSheet.js`: 文字起こし転記
- `compositionDraftGenerator.js`: 構成案生成
- `createShootingFolder.js`: 撮影フォルダ作成
- `promptDialog.js`: プロンプトダイアログ

---

## ファイル構成

```
C:\work-manual\
├── HANDOFF.md                      # このファイル
├── docs/
│   ├── manual-creation-guideline.md  # マニュアル作成ガイドライン ★重要
│   ├── gas/                        # GASスクリプト（商材別フォルダ）
│   │   ├── tsunageru/              # ツナゲル専用
│   │   │   ├── settingsSheet.js         # 設定シート管理 ★単独
│   │   │   ├── hearingSheetManager.js   # メイン（onOpen含む）
│   │   │   ├── createShootingFolder.js  # 撮影フォルダ作成
│   │   │   ├── promptDialog.js          # プロンプトダイアログ
│   │   │   ├── transcriptToHearingSheet.js  # 文字起こし転記
│   │   │   ├── compositionDraftGenerator.js # 構成案生成
│   │   │   ├── sheetStructureChecker.js # メンテナンス用
│   │   │   └── _archive/           # 旧バージョン・未使用ファイル
│   │   └── (他商材)/               # 追加時にフォルダ作成
│   ├── prompts/                    # AIプロンプト
│   └── 業務一覧/                   # 商材別業務詳細（txt）
│
├── src/
│   ├── app/                        # Next.js Pages
│   ├── components/
│   │   ├── ContentModal.tsx        # ポップアップモーダル
│   │   └── TaskCard.tsx            # 業務カード
│   └── lib/
│       ├── data.ts                 # 再エクスポート
│       └── data/                   # 商材別データ
│           ├── index.ts            # 型定義
│           ├── tsunageru.ts        # ツナゲル（モデル）
│           └── ...                 # 他8商材
│
└── public/images/                  # スクリーンショット
```

---

## 開発コマンド

```bash
npx tsc --noEmit    # TypeScriptエラーチェック（コード変更後は必ず実行）
```

---

## 新形式とは

ツナゲルで確立した業務カードの形式。詳細は `docs/manual-creation-guideline.md` 参照。

**要点:**
- `flowSteps`: 業務の手順を横並びボックスで表示
- `inputFields`: 複数入力フィールド（企業名、日時、宛先等を個別入力）
- 画像は必ずキャプション付き（`{ url, caption }`形式）
- 担当者名はハードコードせず、`defaultValue`で設定

---

## 本セッションの進捗（2026-01-10）

### ✅ 完了: 入力データの永続化

**実装内容:**
1. `hearingSheetManager.js`: Part③セクション（処理データ）をテンプレートに追加
2. `settingsSheet.js`: PART3_MAPPING、`savePart3Data()`、`loadPart3Data()` 関数を追加
3. `transcriptToHearingSheet.js`: 文字起こし原文の保存・読み込み機能を実装
4. `compositionDraftGenerator.js`: 構成案の保存・読み込み機能を実装

**Part③セクション構造:**
```
Part③ 処理データ（システム管理）
├─ 行135: 撮影素材フォルダURL
├─ 行136: メインフォルダURL
├─ 行137-141: 文字起こし原文（5行分）
├─ 行142-149: 構成案（原稿用）（8行分）
└─ 行150-157: 構成案（動画用）（8行分）
```

**UI改善:**
- シート選択時に「保存済み」バッジ表示
- 自動読み込み（ダイアログ開いたときに前回の入力を復元）
- 「💾 シートに保存」ボタン追加
- 上書き確認ダイアログ

---

### ✅ 完了: 撮影フォルダ作成の改善

**実装内容:**
1. `createShootingFolder.js`: 「📂 企業シートから作成」メニュー追加
2. 企業シート選択ダイアログ: 企業名を手入力せず、シート選択だけでフォルダ作成
3. フォルダURL自動保存: 作成したフォルダURLを企業シートPart③に自動保存
4. 「作成済み」バッジ: 既にフォルダがある企業シートには警告表示

**新メニュー構造:**
```
２.📁 撮影フォルダ
├── 🆕 新規フォルダ作成（従来の手入力方式）
├── 📂 企業シートから作成 ★新規
├── 📋 最近作成したフォルダ一覧
└── ⚙️ 親フォルダを設定
```

---

### 完了: 設定シートGAS完成（settingsSheet.js）

**メニュー構造:**
```
０.⚙️ 設定
├── 📋 設定シートを作成
├── 👥 メンバー編集
├── 📝 業務担当者編集（複数人対応・チェックボックス方式）
├── 📁 フォルダ設定編集（サブフォルダ追加・削除可能）
└── 📄 プロンプト編集（一覧・追加・編集・削除）
```

**設定シート構造:**
```
A列〜B列: メンバー一覧（名前、備考）
D列〜F列: 業務担当者（No、業務名、担当者 ※複数可・カンマ区切り）
H列〜I列: フォルダ設定（親フォルダID案内、サブフォルダ1〜）
```

**フォルダ管理の分離:**
- 親フォルダID: PropertiesService（「📁撮影フォルダ」→「親フォルダを設定」から変更）
- サブフォルダ: 設定シートH列（ダイアログで追加・削除可能）

**getValue系関数（他GASから呼び出し）:**
- `getMemberList()` → メンバー一覧
- `getAssigneeByTaskNo(no)` → 業務Noから担当者取得
- `getSubfoldersFromSettings()` → サブフォルダ一覧
- `getSettingsFromSheet()` → 後方互換（役割ベース）

---

## 次回セッションでやること（重要・必読）

### ✅ 完了: settingsSheet.js の同期と連携

**設定シートの設計意図:**

| 列 | 用途 | 重要度 |
|----|------|--------|
| **A列（メンバー一覧）** | 各ダイアログで担当者を選ぶ**ドロップダウンの選択肢** | **メイン** |
| D〜F列（業務担当者） | デフォルト値を決めるだけ | サブ |
| H列（フォルダ設定） | サブフォルダ名など | サブ |

**完了済み（2026-01-10）:**
1. ✅ settingsSheet.js をGASエディタに追加済み
2. ✅ createShootingFolder.js がサブフォルダを `getSubfoldersFromSettings()` から取得するよう修正
3. ✅ 撮影担当者テンプレートが設定シートの担当者を使用するよう修正

---

### ✅ 完了: 担当者プレースホルダーの実装

**settingsSheet.js で定義済みの機能:**
```javascript
// 設定シートから担当者情報を取得
getSettingsFromSheet()  // → { '原稿担当1': '河合', '動画担当': '川崎', ... }

// プレースホルダーを置換
replacePlaceholders(text, settings)
// {{原稿担当1}} → 河合
// {{@原稿担当1}} → @河合
// {{原稿チーム}} → 河合・中尾文香
// {{@原稿チーム}} → @河合 @中尾文香
```

**完了済み（2026-01-10）:**
1. ✅ compositionDraftGenerator.js: 変換ダイアログで `replacePlaceholders()` 呼び出し済み（776行）
2. ✅ transcriptToHearingSheet.js: プロンプト生成時に `replacePlaceholders()` 呼び出し追加（133-137行）
3. ✅ createShootingFolder.js: 撮影担当者テンプレートで `getSettingsFromSheet()` から担当者取得（176-177行、497-499行）

**プロンプトシートのテンプレートにプレースホルダーを記載可能:**
- 例: `CC: {{@CC}}`、`原稿担当: {{@原稿チーム}}`

---

### ✅ 完了: 入力データの永続化

**実装済み:** 本セッションの進捗を参照

---

### ✅ 完了: 撮影フォルダ作成の改善

**実装済み:** 本セッションの進捗を参照

**今後の拡張（オプション）:**
- ヒアリングシート作成時に自動でフォルダも作成する機能
- フォルダURLプレースホルダー（`{{撮影素材フォルダURL}}`）のテンプレート対応

---

### ★★★ 次回やること: 連絡フォーマットGASの作成 ★★★

**目的:**
業務フローで使う連絡テンプレートをGASダイアログから生成できるようにする。
Next.js（マニュアルサイト）のpopupと同じテンプレートをGASでも使えるようにする。

---

#### 1. GASメニュー構造

```
１.📋 ヒアリングシート
２.📁 撮影フォルダ
３.📨 連絡フォーマット  ★新規作成
  ├── 【受注時】フォーム記入依頼
  ├── 【受注時】カレンダー登録
  ├── 【受注時】ワークス共有
  ├── ─────────────
  ├── 【打合せ前】撮影可能日5候補確認
  ├── 【打合せ前】参加者へリマインド
  ├── ─────────────
  ├── 【打合せ後】撮影指示連絡
  └── 【打合せ後】議事録共有
４.📝 プロンプト（議事録・構成案）
⚙️ 設定
```

**命名規則:**
- 業務Noは使わない（スプシユーザーにはわからないため）
- 代わりに業務タイミングを簡潔に: 【受注時】【打合せ前】【打合せ後】

---

#### 2. 各連絡フォーマットの仕様

**共通仕様:**
- 全テンプレートの末尾に「署名」を追加
- 署名には ヒアリングシートURL と 撮影素材フォルダURL を含む
- 担当者・CCはドロップダウンで選択可能（設定シートから取得）
- デフォルト値は設定シートの業務担当者から取得

**署名フォーマット:**
```
━━━━━━━━━━━━━━━━━━━━
📎 関連リンク
━━━━━━━━━━━━━━━━━━━━
📋 ヒアリングシート: {{hearingSheetUrl}}
📁 撮影素材フォルダ: {{folderUrl}}
```

---

#### 3. 各テンプレート詳細

**【受注時】フォーム記入依頼**
```
入力項目:
- 宛先（メールアドレス）
- 企業名
- 担当者名
- フォームURL

テンプレート:
件名: 【ご依頼】ヒアリングフォームのご記入のお願い

{{担当者名}}様

お世話になっております。株式会社Singの{{自分の名前}}です。
この度はツナゲルにお申し込みいただきありがとうございます。

つきましては、事前ヒアリングフォームのご記入をお願いいたします。

▼ヒアリングフォーム
{{フォームURL}}

ご不明点がございましたらお気軽にお問い合わせください。
よろしくお願いいたします。
```

**【受注時】カレンダー登録**
```
入力項目:
- 企業名
- 打ち合わせ日時
- Meet URL
- 参加者

テンプレート:
【初回打ち合わせ】{{企業名}}様
日時: {{日時}}
場所: オンライン（Google Meet）
URL: {{meetUrl}}
参加者: {{参加者}}
```

**【受注時】ワークス共有**
```
入力項目:
- 企業名
- 打ち合わせ日時
- 担当者

テンプレート:
@ALL
{{企業名}}様の案件を立ち上げました。

【初回打ち合わせ】{{日時}}
【担当】{{担当者}}

よろしくお願いします。

+ 署名
```

**【打合せ前】撮影可能日5候補確認**
```
入力項目:
- 宛先（撮影担当）: ドロップダウン
- CC: ドロップダウン（複数選択可）
- 企業名
- 初回打ち合わせ日

テンプレート:
{{宛先}} cc:{{CC}}
{{企業名}}様の撮影について相談です。

初回打ち合わせ：{{打合せ日}}予定
打ち合わせで先方に撮影候補日を提示したいので、
打ち合わせ日以降で撮影可能な日程を5候補ほど教えてください。

よろしくお願いします。

+ 署名
```

**【打合せ前】参加者へリマインド**
```
入力項目:
- 宛先: ドロップダウン（複数選択可）
- 企業名
- 日時
- Meet URL

テンプレート:
{{宛先}}
{{企業名}}様の初回打ち合わせリマインドです。

【日時】{{日時}}
【Meet URL】{{meetUrl}}

よろしくお願いします。

+ 署名
```

**【打合せ後】撮影指示連絡**
```
入力項目:
- 宛先（撮影担当）: ドロップダウン
- CC: ドロップダウン（複数選択可）
- 企業名
- 撮影日
- 場所
- 住所
- インタビュー対象
- 備考

テンプレート:
{{宛先}} cc:{{CC}}
{{企業名}}様の撮影日程が確定しましたのでご連絡します。

【撮影日】{{撮影日}}
【場所】{{場所}}
【住所】{{住所}}
【インタビュー対象】{{インタビュー対象}}
【備考】{{備考}}

━━━━━━━━━━━━━━━━━━━━
📁 撮影データの保存先
━━━━━━━━━━━━━━━━━━━━
撮影後、以下のフォルダに素材をアップロードしてください。
{{folderUrl}}

確認したらリアクションお願いします。

+ 署名
```

**【打合せ後】議事録共有**
```
入力項目:
- 撮影担当メンション: ドロップダウン
- 企業名
- 議事録（テキストエリア）

テンプレート:
@ALL {{撮影担当}}
{{企業名}}様 初回打ち合わせの議事録を共有します。

{{議事録}}

ご確認お願いします。

+ 署名
```

---

#### 4. 実装ファイル

**新規作成:** `docs/gas/tsunageru/contactFormats.js`

**機能:**
1. `addContactFormatsMenu(ui)` - メニュー追加（onOpenから呼び出し）
2. 各連絡フォーマットのダイアログ表示関数
3. 設定シートから担当者リスト取得（`getMemberList()`を使用）
4. 企業シートのPart③からURL取得（`loadPart3Data()`を使用）

**hearingSheetManager.jsの修正:**
```javascript
// onOpen()に追加
addContactFormatsMenu(ui);  // ３.📨 連絡フォーマット
```

---

#### 5. Next.jsとの連動

**現状:**
- Next.js（tsunageru.ts）のpopupには署名・URLを追加済み
- GASには連絡フォーマットダイアログがない

**方針:**
- GASとNext.jsで**同じテンプレート**を使う
- どちらからでも同じ結果が得られるようにする
- GAS: スプレッドシートから直接使う人向け
- Next.js: マニュアルサイトから使う人向け

**同期の維持:**
- テンプレートを変更する際は、両方を同時に更新する
- HANDOFF.mdに変更履歴を記載する

---

#### 6. 担当者ドロップダウンの仕様

**データソース:** 設定シートのメンバー一覧（A列）

**UI仕様:**
- 単一選択: ラジオボタン or セレクトボックス
- 複数選択: チェックボックス

**デフォルト値:**
- 設定シートの業務担当者から取得
- 例: 撮影担当 → 「撮影」業務の担当者

---

### 優先度中: ツナゲル配列順6〜13の新形式移行

配列順0〜5と同様に、残りの業務を新形式に移行:
- flowSteps追加
- 複数入力フィールド対応
- 画像はキャプション付き

---

### 優先度低: 他商材のブラッシュアップ

ツナゲル完了後、優先度順に他商材を整備:
1. バツグン（撮影・FBフローはツナゲルと共通部分多い）
2. HP制作
3. 以降は必要に応じて

---

### 保留中

| 項目 | 状況 |
|------|------|
| YouTubeアップロード手順 | flowStepsに追加予定 |

---

## 関連リンク

- **制作陣業務一覧**: 元データのスプレッドシート
- **ヒアリングシート（テンプレート）**: GAS動作確認用

---

## 担当者一覧（ツナゲル）

| 担当者 | 色 | 主な業務 |
|--------|-----|---------|
| 渡邉 | グレー | 受注・立ち上げ、日程調整 |
| 河合 | ピンク | 打ち合わせ、原稿、編集 |
| 中尾文香 | 黄色 | 原稿執筆 |
| 川崎 | 水色 | 企画、撮影、FB |
| 下脇田 | 紫 | FB |
| 紺谷 | オレンジ | 応募対応 |

---

## 更新履歴

| 日付 | 内容 |
|------|------|
| 2026-01-10 | **連絡フォーマットGAS設計**: 7種類のテンプレート仕様・メニュー構造・Next.js連動方針をHANDOFFに詳細記載 |
| 2026-01-10 | **マニュアルフロー改善**: No.2に撮影フォルダ作成移動、全連絡に署名（URL）追加、撮影指示に保存先明記 |
| 2026-01-10 | **入力データの永続化完了**: Part③セクション追加、文字起こし・構成案の保存機能実装 |
| 2026-01-10 | **撮影フォルダ作成改善完了**: 企業シートから作成機能、フォルダURL自動保存 |
| 2026-01-10 | 撮影フォルダGAS改善: 担当者/CCドロップダウン、プレーンテンプレート、メニュー修正 |
| 2026-01-10 | GAS修正完了: サブフォルダ・撮影担当者・プレースホルダー連携を実装 |
| 2026-01-10 | HANDOFF修正: GAS同期未完了・サブフォルダ未連携・プレースホルダー未実装を警告追加 |
| 2026-01-10 | 設定シートGAS完成（プロンプト編集・複数担当者・フォルダ設定改善） |
| 2026-01-10 | 設定シートGAS作成（settingsSheet.js）業務Noベース設計 |
| 2026-01-10 | HANDOFF最適化（詳細履歴を削除、ガイドラインに移行） |
| 2026-01-10 | 複数入力フィールド対応完了 |
| 2026-01-10 | ツナゲル配列順0〜5の新形式統一 |
| 2026-01-10 | GAS同期: 古いファイルをアーカイブ移動、メニュー名更新 |
| 2026-01-09 | 構成案生成GAS作成 |
| 2026-01-08 | flowSteps改善、画像追加 |
| 2026-01-07 | 初期構築（Next.js、データ構造、GAS連携） |
