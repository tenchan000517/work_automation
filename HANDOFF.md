# 業務効率化・マニュアル作成プロジェクト HANDOFF

## 🎯 次世代セッションタスク（2026-01-30 更新）

### HP制作フロー改善（進行中）

HP制作のフローをツナゲルと同じ設計思想で整備する。現状は「何をやるか」のラベルだけで、「どうやるか」の詳細がない。

#### ツナゲルとの比較（立ち上がり〜初回打ち合わせ）

| 項目 | ツナゲル | HP制作（現状） |
|------|---------|----------------|
| **タスク分割** | 3タスクに分離 | 1タスクにまとめ |
| **フロー詳細度** | 各ステップにsummary, description, links, images | labelのみ |
| **担当者分担** | 渡邉(営業)→河合(制作)→両者 | 河合のみ |
| **Googleフォーム** | 事前回答収集あり | なし |
| **ヒアリングシート** | GASメニューで自動作成 | 記載なし |
| **撮影日程調整** | 撮影担当への事前確認ステップあり | 「川崎」と記載のみ |
| **リマインド** | 参加者へのリマインドステップあり | なし |
| **録画準備** | NOTTA準備ステップあり | なし |
| **ステータス管理** | 各タスク末にステータス更新あり | なし |

#### ツナゲルのフロー構成（参考）

**No.0 受注・立ち上げ**（担当: 渡邉）
```
①グループ作成 → ②情報共有 → ③日程調整 → ④カレンダー登録 → ⑤ワークス共有 → ⑥ステータス更新
```

**No.1 打ち合わせ前準備**（担当: 河合）
```
①回答確認 → ②シート作成 → ③フォルダ作成 → ④撮影日確認 → ⑤リマインド → ⑥リアクション確認 → ⑦録画準備 → ⑧ステータス更新
```

**No.2 初回打ち合わせ**（担当: 渡邉, 河合）
```
（打ち合わせ実施フロー）
```

#### HP制作の現状フロー

**No.0 テンプレート選定**（担当: 河合）- 1タスクに全部入り
```
①ワークス立ち上げ・企業情報共有 → ②日程共有 → ③ZOOM初回打ち合わせ → ④撮影日程調整 → ⑤議事録共有 → ⑥フォルダ作成
```

#### 改善方針

1. **タスク分割**: ツナゲルと同様に「受注・立ち上げ」「打ち合わせ前準備」「初回打ち合わせ」に分割
2. **フロー詳細化**: 各ステップにsummary, description, linksを追加
3. **担当者明確化**: 営業（渡邉）と制作（河合）の役割分担を明確に
4. **ステータス管理**: 各タスク末にステータス更新ステップを追加

#### 担当者情報（確定）

- 河合: 構成設計、デザイン、コーディング、確認依頼、キックオフMTG、月次FB
- 川崎: 素材撮影
- 青柳: CC（全工程で報告を受ける）
- ※中尾はHP制作に関与しない

#### 関連リソース

- HPテンプレート: `/mnt/c/sing-hp-template/`
- 修正マニュアル: https://sing-hp-template.vercel.app/manual

---

### HP制作マニュアル修正 ✅ 完了（2026-01-30）

**完了した作業:**
- [x] `hp.ts` のタスク番号を連番（0〜7）に変更
- [x] 担当者から中尾を削除
- [x] `docs/manuals/hp/` ディレクトリ作成
- [x] マニュアルファイル8つ作成（00〜07）
- [x] `manualDraft` をmdファイルに分離

---

### ツナゲル検証・インフォ/マニュアル更新

新しいフローでの実際の検証を行い、スクショ撮影→インフォ更新→マニュアル更新を進める。

**作業開始前の確認事項:**
1. ガイドラインv3を熟読し、以下を理解する:
   - 意図・コンセプト・理念
   - KGI・要件
   - 設計思想
   - インフォ作成ルール
   - マニュアル作成ルール
2. 品質チェック項目を確認

**必読ドキュメント:**
- `docs/manual-creation-guideline-v3.md` ← 最重要

**作業内容:**
1. **No.0〜5**: 既存インフォ/マニュアルの更新（新フローでスクショ撮影）
2. **No.6〜13**: インフォ作成、フロー確定、実装（未着手業務）

**現状:**
- No.0〜5: インフォ/マニュアル作成済み（更新が必要な可能性）
- No.6〜13: 基本情報のみ、詳細フロー未確定

**インフォ/マニュアルファイル:**
```
docs/manuals/tsunageru/
├── 00-受注・立ち上げ.md
├── 01-打ち合わせ前準備.md
├── 02-初回打ち合わせ.md
├── 03-議事録作成.md
├── 04-構成案作成.md
├── 05-撮影準備.md
├── 06-撮影.md          ← ここから要実装
├── 07-動画編集.md
├── 08-原稿執筆.md
├── 09-求人原稿入稿.md
├── 10-確認依頼〜承認.md
├── 11-動画入稿・公開.md
├── 12-初回FB.md
└── 13-月次FB.md
```

---

## 📋 GAS最適化タスク（2026-01-14 作成・一部完了）

**レポート**: `docs/gas-optimization-report.md`

GASコードの最適化調査を実施。設計思想に沿った改善箇所を特定済み。

**完了した作業（2026-01-14）:**
- [x] 1-1. settingsSheet.js 4ダイアログのスタイル統一（CI_DIALOG_STYLES、CI_UI_COMPONENTS使用）
- [x] commonStyles.jsにbtn-add、btn-deleteを追加
- [x] 4ダイアログのサイズを700x750に統一
- [x] 3ダイアログに「※設定シートの○○列で手動でも変更可能です」を追加
- [x] 1-5. contactFormats.js 除外シート判定を`isExcludedSheet()`に統一
- [x] 1-5追加. `isExcludedSheet()`に「進捗管理」を追加
- [x] 1-7. createShootingFolder.js `SUBFOLDERS`定数削除（デッドコード）
- [x] 1-8. createShootingFolder.js `PARENT_FOLDER_ID`定数削除、フォールバックを`null`に
- [x] 1-4. companyInfoManager.js メンバー名を`settings['XXX'] || 'フォールバック'`パターンに
- [x] 1-6. contactFormats.js メンバー名を`settings['XXX'] || 'フォールバック'`パターンに

**保留中（設計検討が必要）:**
- 1-2. getInputKeyForPrompt() → 「将来の改善」セクション参照

**未着手:**
- 1-3（hearingSheetManager.js ステータス関連）

**作業時の必読ドキュメント**:
1. `docs/gas-optimization-report.md` - 具体的な問題箇所・改善方法
2. `docs/manual-creation-guideline-v3.md` - 設計思想・ルール

**設計原則（厳守）**:
- 設定値はハードコードせず、設定シートから`getXxx()`関数で取得
- スタイルはcommonStyles.jsの`CI_DIALOG_STYLES`、`CI_UI_COMPONENTS`を使用
- 「GAS」という表現は使わない → 「ヒアリングシートのメニュー」
- ダイアログサイズは700x750に統一

---

## 🚨 緊急引き継ぎ（2026-01-14 更新）

### flowStepsにステータス更新ステップを追加 - 完了

全14タスクのflowStepsの最後に「ステータス更新」ステップを追加。業務完了後、次の担当者へ引き継ぐためにステータスを更新する流れを明示化。

**追加内容:**
```typescript
{
  label: "ステータス更新",
  summary: "ヒアリングシートのメニューからステータスを更新",
  links: [
    { label: "ヒアリングシート", type: "link", url: "https://..." }
  ],
  description: `業務完了後、ヒアリングシートのステータス更新ダイアログで...`,
}
```

**表現ルール（非エンジニア向け）:**
- 「GAS」という表現は使わない → 「ヒアリングシートのメニュー」と記載
- 「メニュー」だけでは不十分 → 必ず「ヒアリングシートの」を付ける

**ガイドラインv3更新:**
- 3.5 表現ルール（非エンジニア向け）追加
- 3.6 ステータス更新ステップの追加
- 6.2 品質チェックに3項目追加

---

### 商材ページUIリファクタリング - 完了

「業務数」「課題感・改善ポイント一覧」「業務サマリー」をページ最下部に移動し、アコーディオン化。

**変更ファイル:**
- `src/components/Accordion.tsx` - 汎用アコーディオンコンポーネント新規作成
- `src/app/products/[id]/page.tsx` - 3セクションを最下部に移動、アコーディオン化

**変更前:** 上部にサマリー情報が表示
**変更後:** 業務詳細カードの後、footerの前にアコーディオンとして配置（デフォルト閉じ）

---

### タスク統合（15→14タスクに変更）- 完了

営業側タスク（No.0とNo.1）を統合し、14タスク（No.0〜13）に変更。

**変更前:** 15タスク（0.受注・ワークス立ち上げ / 1.日程調整 / 2.打ち合わせ前準備 / ...）
**変更後:** 14タスク（0.受注・立ち上げ / 1.打ち合わせ前準備 / 2.初回打ち合わせ / ...）

**変更ファイル:**
- `docs/manuals/tsunageru/` - 00と01を統合、02〜14を01〜13にリネーム
- `src/lib/data/tsunageru.ts` - taskCount: 13、タスク番号繰り上げ
- `docs/gas/tsunageru/progressManager.js` - getTasks()で設定シートから取得、PHASE_MAPPINGでphase付与
- `docs/gas/tsunageru/settingsSheet.js` - DEFAULT_TASKSを14タスクに
- `docs/gas/tsunageru/hearingSheetManager.js` - progressManager.jsのTASKSを参照（設定シート連携）

**タスク定義の一元化:**
- 設定シートD〜F列がマスター（getAllTaskAssignees()で取得）
- progressManager.jsのgetTasks()が設定シートから取得→phaseを付与
- hearingSheetManager.jsはprogressManager.jsのTASKSを参照
- タスク追加・変更時は設定シートを編集するだけでOK

**製作陣の役割変更:**
- グループ立ち上げを確認したら、各種対応が進んでいるかウォッチ
- 必要に応じて自ら対応（リマインド、日程調整の補助など）

---

### ステータス欄の修正（6項目）- 完了

#### 確定したステータス欄の構成

| 列 | 2行目（ヘッダー） | 3行目（入力） | 選択肢 |
|----|-----------------|--------------|--------|
| B | 現在タスク | ドロップダウン | 14段階（0.受注・立ち上げ〜13.月次FB） |
| C | タスク保持者 | ドロップダウン | 7名 |
| D | 状態 | ドロップダウン | 対応中 / 先方確認 / 次の担当へ |
| E | 期限 | 日付 | - |
| F | 最終更新日 | 自動 | - |
| G | 全体ステータス | ドロップダウン | 制作中 / 運用中 / 完了 |

#### 修正済みファイル

1. **hearingSheetManager.js**
   - `createStatusSection()` を6項目に修正
   - `setupTemplate()` の最初で `clearDataValidations()` 追加済み
   - `createLogHeader()` 追加（I〜N列にログヘッダー作成）

2. **progressManager.js**
   - `STATUS_COLUMNS` を6項目（B〜G列）に修正
   - `LOG_COLUMNS` 追加（I〜N列: ログエリア）
   - `STATUS_STATES` 追加（対応中 / 先方確認 / 次の担当へ）
   - `STATUS_OVERALL` 追加（制作中 / 運用中 / 完了）
   - `addStatusSection()` を6項目に修正
   - `getStatusFromSheet()` を6項目に対応
   - `hasStatusSection()` を修正
   - `updateSheetStatus()` を6項目に対応（最終更新日を自動更新 + ログ追加）
   - `createStatusUpdateHtml()` に状態・全体ステータス・メモを追加
   - `ensureLogHeader()` 追加（ログヘッダー作成）
   - `addUpdateLog()` 追加（ログ追加処理）
   - `calculateDuration()` 追加（工数計算）
   - 進捗一覧シートのヘッダーを8列に拡張
   - 条件付き書式に「先方確認」「完了」のルール追加

### ステータス更新ダイアログを全メニューに追加

全ての主要メニューの最後に「✏️ ステータス更新」を追加。どのメニューからでも `showStatusUpdateDialog()` を呼び出せる。

**追加したメニュー:**
- １.📋 企業情報入力（companyInfoManager.js）
- ２.📋 初回打ち合わせ（hearingSheetManager.js）
- ３.📝 議事録作成（promptDialog.js）
- ４.📝 構成案作成（compositionDraftGenerator.js）
- 📨 連絡フォーマット（contactFormats.js）
- ４.📝 文字起こし整理・転記（transcriptToHearingSheet.js）

### 更新ログ機能（I〜N列）

ステータス更新ダイアログから更新するたびに、I列〜N列にログが追記される。

**ログ構造:**
```
I1: 更新ログ（タイトル）
I2: 日時 / J2: タスク変更 / K2: 保持者変更 / L2: 状態 / M2: メモ / N2: 工数
I3: 1/14 15:30 / 3→4 / 渡邉→河合 / 対応中 / 確認依頼送付 / 2h
I4: 1/14 13:30 / 1→3 / - / 対応中 / 打ち合わせ完了 / 3d2h
...
```

**記録内容:**
- 日時: M/d HH:mm形式
- タスク変更: 番号のみ（3→4）、変更なしは「-」
- 保持者変更: 名前（渡邉→河合）、変更なしは「-」
- 状態: 対応中 / 先方確認 / 次の担当へ
- メモ: ダイアログで入力した任意テキスト
- 工数: 前回ログからの経過時間（自動計算）

### 作成したデバッグツール

- `docs/gas/tsunageru/sheetDumper.js` - シート構造をダンプ（値、背景色、列幅、ドロップダウン）

---

## 最近完了した機能（2026-01-14）

### 進捗管理機能（新規実装）

マネージャー（青柳CC）向けの進捗把握機能を追加。各企業プロジェクトの現在タスク・担当者・期限を一覧で確認可能。

**機能概要:**
1. **ステータス欄**: 各ヒアリングシートの2-3行目にステータス欄を追加（2行構成）
2. **進捗一覧シート**: 全企業のステータスを自動集約して一覧表示

**ヒアリングシート構造変更:**
```
1行目: 企業名（タイトル）
2行目: ステータスヘッダー（現在タスク / タスク保持者 / 状態 / 期限 / 最終更新日 / 全体ステータス）← B〜G列
3行目: ステータス入力欄（ドロップダウン / ドロップダウン / ドロップダウン / 日付 / 自動 / ドロップダウン）
4行目: Part① 基本情報
5行目〜: 企業概要など（従来より+1行ずれ）
```

**ステータス項目（6項目）:**
- 現在タスク: 0.受注・立ち上げ / 1.打ち合わせ前準備 / ... / 13.月次FB（14段階）
- タスク保持者: 渡邉 / 河合 / 川崎 / 中尾文香 / 紺谷 / 下脇田 / 先方
- 状態: 対応中 / 先方確認 / 次の担当へ
- 期限: 日付（任意）
- 最終更新日: 自動記録
- 全体ステータス: 制作中 / 運用中 / 完了

**進捗一覧シートの条件付き書式:**
- タスク保持者が「先方」→ 黄色背景
- 状態が「先方確認」→ 黄色背景
- 期限が過ぎている → 赤背景
- 全体ステータスが「完了」→ 緑背景

**GASメニュー:**
```
📊 進捗管理
├── 📋 進捗一覧シートを作成
├── 🔄 進捗一覧を更新
├── ─────────────
├── 📝 現在のシートにステータス欄を追加
├── 📝 全シートにステータス欄を追加
├── ─────────────
└── ✏️ ステータス更新
```

**関連ファイル（行番号+1対応済み）:**
- `docs/gas/tsunageru/progressManager.js` - 進捗管理機能（新規）
- `docs/gas/tsunageru/hearingSheetManager.js` - FORM_TO_SHEET_MAPPING行番号+1
- `docs/gas/tsunageru/compositionDraftGenerator.js` - PART1/PART2_MAPPING行番号+1
- `docs/gas/tsunageru/transcriptToHearingSheet.js` - TRANSCRIPT_TO_SHEET_MAPPING行番号+1
- `docs/gas/tsunageru/createShootingFolder.js` - getRange(6, 3)に変更
- `docs/gas/tsunageru/companyInfoManager.js` - getRange(6, 3)に変更
- `docs/gas/tsunageru/promptDialog.js` - getRange(6, 3)に変更

---

### フローステップタイトル改善・UI微調整（完了）

**タイトル改善:**
1. タイトルを簡潔化（例: 「ワークスで企業グループを作成」→「グループ作成」）
2. summaryに詳細説明を追加（例: 「LINEWORKSで企業グループを立ち上げる」）
3. ボタンの絵文字（📄📋）を削除

**共通化されたタイトル例:**
- 日程調整、カレンダー登録、ワークス共有、リアクション確認
- シート作成、フォルダ作成、議事録作成、構成案作成
- NOTTA起動、NOTTA確認、すり合わせ
- 撮影連絡、撮影、データチェック、動画編集
- 確認依頼、承認取得、FB実施、FB日程確定

**UI微調整:**
- カード幅: w-32(128px) → w-40(160px)
- カード間余白: gap-2 → gap-1
- カード内余白: px-3 → px-2.5
- ボタン横幅: 統一（w-full + justify-center）
- タイトル左余白: ml-1追加
- メインコンテンツ左右余白: px-4/8/12 → px-3/6/8

**関連ファイル:**
- `src/components/TaskCard.tsx` - カード・ボタンスタイル調整
- `src/lib/data/tsunageru.ts` - 全15タスクのflowSteps改善
- `src/app/products/[id]/page.tsx` - 左右余白調整

---

### フローステップのデザイン改善（完了）

**変更内容:**
```
【PC】横並び折り返し、固定幅
┌──────┐  ▶  ┌──────┐  ▶  ┌──────┐
│ ① ラベル│     │ ② ラベル│     │ ③ ラベル│
│ summary │     │ summary │     │ summary │
│ [ボタン]│     │ [ボタン]│     │ [ボタン]│
└──────┘     └──────┘     └──────┘

【モバイル】縦並び、コンテナ幅いっぱい
┌────────────────────────┐
│ ① ラベル / summary / [ボタン] │
└────────────────────────┘
              ▼
┌────────────────────────┐
│ ② ラベル / summary / [ボタン] │
└────────────────────────┘
```

**実装詳細:**
- `FlowStep`型に`summary`フィールド追加
- PC: 固定幅（w-40 = 160px）、横並び折り返し
- モバイル: コンテナ幅いっぱい（w-full）、縦並び
- 高さ: min-h-[120px]
- ステップ番号を左上に丸バッジで表示
- 矢印: 丸の中にChevronRight/ChevronDown（リッチなデザイン）
- `hasFlowSteps`未使用変数削除

### モバイルハンバーガーメニュー（完了）

**変更内容:**
- ヘッダーにハンバーガーアイコン追加（モバイルのみ）
- Menu ↔ X の回転アニメーション
- `ProductPageLayout`にヘッダーを統合
- Sidebarの開くボタンはデスクトップのみ表示（`hidden lg:block`）
- モバイルではデフォルトでメニュー閉じ

**関連ファイル:**
- `src/components/ProductPageLayout.tsx` - ヘッダー統合、ハンバーガーメニュー
- `src/components/Sidebar.tsx` - 開くボタンをデスクトップのみに
- `src/app/products/[id]/page.tsx` - ヘッダー削除（ProductPageLayoutに移動）

---

## プロジェクト概要

制作陣の業務効率化とマニュアル整備プロジェクト。
9商材・52業務を対象に、AI活用による効率化とマニュアル改善を推進。

**ガイドライン**:
- `docs/manual-creation-guideline-v3.md` ★最新版（新商材作成の完全ガイド）
- `docs/manual-creation-guideline-v2.md` UI仕様詳細（GASダイアログコンポーネント）
- `docs/manual-creation-guideline.md` 旧版（データ構造・型定義の参照用）

---

## 設計思想

### スプレッドシート中心の設計
本体はスプレッドシート+GAS。Next.jsサイトは補助（閲覧用ビュー）。

**理由**: 担当者が直接メンテナンスできる。コード変更不要。

### GASの2つの機能
- **AIプロンプト生成**: データ+プロンプト → AIに貼り付け → AI出力を使う
- **フォーマット生成**: データ+テンプレート → そのまま使える定型文

### 基本セット構成
- プロンプトシート（AIプロンプト管理）
- 設定シート（担当者名等の設定値）
- フォーム連携時: 回答シート + 原本シート

### 入力データの永続化
ダイアログで入力したデータは一時的ではなく、スプレッドシートに保存して再利用する。

**フロー:**
1. 貼り付け → 対象シートのセルに保存
2. 次回開く → セルから読み込み → フィールドに自動入力
3. 後続フローでも同じデータを参照可能

---

## 商材別業務一覧

| 商材 | 業務数 | 進捗 |
|------|--------|------|
| ツナゲル | 14 | GAS実装済み |
| バツグン | 5 | 基本情報のみ |
| HP制作 | 8 | 基本情報のみ |
| LP制作 | 5 | 基本情報のみ |
| SNS広告 | 5 | 基本情報のみ |
| PV制作 | 5 | 基本情報のみ |
| パンフ | 3 | 基本情報のみ |
| ロゴ | 3 | 基本情報のみ |
| 月刊Sing | 4 | 基本情報のみ |
| **合計** | **52** | - |

---

## GASメニュー構成（ツナゲル）

```
０.⚙️ 設定
├── 👥 メンバー編集
├── 📝 業務担当者編集
├── 📁 フォルダ設定編集
├── ─────────────
├── 📄 プロンプト編集
├── ─────────────
├── 📋 設定シートを作成
├── 📝 プロンプトシートを作成
└── 📊 企業情報一覧を作成

１.📋 企業情報入力
├── 📥 企業情報入力（ワークス貼り付け）
├── 📢 受注・キックオフ連絡
├── 📩 先方へ日程調整・フォーム記入依頼メール
├── ─────────────
├── 🏢 企業情報編集
├── ─────────────
└── 📊 企業情報一覧反映

２.📋 初回打ち合わせ
├── 🆕 新規ヒアリングシート作成（フォーム回答から）
├── 🆕 新規ヒアリングシート作成（手動）
├── ─────────────
├── 📂 新規フォルダ作成（企業シートから）
├── 🆕 新規フォルダ作成（手動）
├── ─────────────
├── 📥 フォーム回答を既存シートに転記
├── ─────────────
├── 📋 最近作成した企業フォルダ一覧
├── ─────────────
├── 🎨 テンプレート初期設定
└── ⚙️ 親フォルダを設定

３.📝 議事録作成
├── （プロンプトシートから動的生成）
├── ─────────────
├── 📋 文字起こしを整理（プロンプト生成）
├── 📥 AI出力を転記
├── ─────────────
├── 📄 プロンプトシートを作成
├── 🔄 サンプルプロンプトを追加
└── ❓ 使い方

４.📝 構成案作成
├── 📋 構成案を作成（プロンプト生成）
├── ─────────────
├── 📤 ペアソナ/エンゲージ形式に変換
├── 📤 ワークス報告用に変換
├── 📤 撮影指示書に変換
├── ─────────────
├── 📸 撮影日程確定報告
├── ─────────────
└── 🔧 シートデータ確認

📨 連絡フォーマット
├── 📋 日程確定報告
├── ─────────────
├── 📷 撮影日程確認
├── 🔔 参加者リマインド
├── ─────────────
├── 🎬 撮影指示連絡
├── 📸 撮影日程確定報告
└── 📝 議事録共有

📊 進捗管理
├── 📋 進捗一覧シートを作成
├── 🔄 進捗一覧を更新
├── ─────────────
├── 📝 現在のシートにステータス欄を追加
├── 📝 全シートにステータス欄を追加
├── ─────────────
├── ✏️ ステータス更新
└── 📝 進捗ログを追加
```

---

## GASファイル構成

```
docs/gas/tsunageru/
├── commonStyles.js           # ★共通スタイル定義
├── settingsSheet.js          # 0.設定シート管理
├── hearingSheetManager.js    # メイン（onOpen含む）2.初回打ち合わせ
├── companyInfoManager.js     # 1.企業情報入力
├── promptDialog.js           # 3.議事録作成
├── compositionDraftGenerator.js # 4.構成案作成
├── contactFormats.js         # 連絡フォーマット
├── progressManager.js        # 📊進捗管理（新規）
├── transcriptToHearingSheet.js  # 文字起こし転記（3に統合）
├── createShootingFolder.js   # 撮影フォルダ作成（2に統合）
├── companyCueGenerator.js    # 企業カンペ作成
└── sheetStructureChecker.js  # メンテナンス用
```

---

## Next.jsサイト共通化（src/lib/data/common/）

商材共通のマニュアル・テンプレートを切り出し、tsunageru.ts等から参照する構成。

```
src/lib/data/common/
├── index.ts
├── manuals/
│   ├── index.ts
│   ├── gas-auth.ts           # GAS認証フロー説明
│   ├── notta.ts              # NOTTA使い方（起動・終了・準備確認）
│   └── works-reaction.ts     # ワークスリアクションルール
└── templates/
    ├── index.ts
    ├── order-notification.ts     # 受注連絡（商材名を引数で渡す）
    ├── schedule-confirm.ts       # 日程確定報告
    ├── reminder.ts               # リマインド
    ├── shooting-request.ts       # 撮影日程確認
    ├── shooting-instruction.ts   # 撮影指示
    ├── minutes-share.ts          # 議事録共有
    ├── fb-report.ts              # FB報告テンプレート（3商材共通）
    └── shooting-checklist.ts     # 撮影時チェックリスト（2商材共通）
```

**テンプレート関数の使い方:**
```typescript
// 商材名を渡すだけで使える
createOrderNotificationTemplate("ツナゲル", "12ヶ月")
createOrderNotificationTemplate("HP制作", "制作")

// 引数なしで呼び出し
createScheduleConfirmTemplate()
createReminderTemplate()

// 定数として直接参照（Task.formatで使用）
format: FB_REPORT_TEMPLATE,      // ツナゲル/バツグン/HP共通
format: SHOOTING_CHECKLIST,      // ツナゲル/バツグン共通
```

---

## ヒアリングシート構成

### Part① 基本情報（フォーム回答から自動転記）
企業名、担当者名、業種、所在地、従業員数など

### Part② ヒアリング情報（打ち合わせ時記入）
- 会社紹介（私たちについて、社長挨拶、会社の魅力、雰囲気）
- 社員の声（最低2名）
- 求人写真
- 重要セクション（★★★）
- 募集情報
- 管理情報
- スカウトメール設定
- **撮影準備**（撮影場所、駐車場、当日担当者、緊急連絡先、必要備品、撮影日時、集合時間）

### Part③ 処理データ（システム管理）
- 撮影素材フォルダURL
- メインフォルダURL
- 文字起こし原文
- 議事録
- 構成案
- ペアソナ/エンゲージ
- 撮影指示書
- 企業カンペURL

---

## 設定シート構成

| 列 | 内容 |
|----|------|
| A-B列 | メンバー一覧 |
| D-F列 | 業務担当者 |
| H-I列 | フォルダ設定 |
| K列 | 企業情報項目 |
| M-N列 | 保存キーマッピング（プロンプト名→Part③保存先） |
| P-Q列 | Part③構成（ラベル名、行数） |

---

## 確定UI一覧

| 項目 | 仕様 |
|------|------|
| ダイアログ横幅 | 700px |
| ダイアログ高さ | 750px（基本値） |
| 担当者選択 | コンパクトドロップダウン |
| 企業選択 | カスタムドロップダウン（チェック・ハイライト・アクティブバッジ） |
| テンプレート表示 | 白背景+枠線、コピーボタンはタイトル行右端 |
| プレビューUI | カード形式、緑コピーボタン |

---

## ワークスのスタンプルール

| ルール | 説明 |
|--------|------|
| ①完了していないならスタンプを押さない | スタンプ = 完了の意思表示 |
| ②5分以上かかるものはタスク・カレンダーに落とし込んでからスタンプ | すぐ対応できないものは先にタスク化 |
| ③既読したらOKスタンプ → 完了したらグッドスタンプに変更 | 👌（OK）= 確認した、対応中 / 👍（グッド）= 完了した |

---

## 撮影関連情報フロー

```
① 日程調整メール
   └→ 「撮影日程を打ち合わせ時に決められれば」+ インタビュイー確認依頼

② 初回打ち合わせ
   └→ 撮影場所、駐車場、当日担当者、緊急連絡先等を聞く

③ 議事録プロンプト
   └→ AIが文字起こしから撮影関連情報も抽出して出力

④ 文字起こし→ヒアリングシート転記
   └→ Part②に自動転記

⑤ 撮影日程確定報告ダイアログ
   └→ Part②から自動読み込み
```

---

## マニュアルのmd分離（実装中）

tsunageru.tsの`manualDraft`をmdファイルに分離し、メンテナンス性を向上させる。

**ファイル配置:**
```
docs/manuals/
├── common/          # 共通マニュアル（複数商材で共有）
│   └── *.md
└── tsunageru/       # 商材固有マニュアル
    ├── 00-受注・ワークス立ち上げ.md
    ├── 01-初回打ち合わせ日程調整.md
    ...
    └── 14-月次FB打合せ.md
```

**読み込み関数:**
- `getManualByTaskNo(productId, taskNo)` → 商材固有マニュアル
- `getCommonManual(name)` → 共通マニュアル

**URL:**
- 商材固有: `/products/{productId}/tasks/{taskNo}/manual`
- 共通: `/manuals/common/{name}`

**移行済み共通マニュアル:**
- `/manuals/common/notta` ← 旧 `/manuals/notta` から移行

**使用パッケージ:**（インストール済み）
```bash
npm install react-markdown remark-gfm rehype-raw
```

**実装済み:**
- [x] パッケージインストール
- [x] ディレクトリ作成（docs/manuals/tsunageru/）
- [x] lib/manuals.ts作成（md読み込み関数）
- [x] ManualMarkdownRenderer.tsx作成（Client Component）
- [x] manual/page.tsx改修（Server Component方式）

**アーキテクチャ:** Server Component方式（ベストプラクティス）
```
manual/page.tsx (Server Component)
    ↓ getManualByTaskNo() で fs.readFile
    ↓ content を props で渡す
ManualMarkdownRenderer (Client Component)
    ↓ react-markdown でレンダリング
```

**残タスク:**
- [x] ~~マークダウンスタイル問題の修正~~ ✅完了
- [x] ~~全15タスクのmdファイル作成（No.0〜14）~~ ✅2026-01-13完了
- [x] ~~tsunageru.tsの`manualDraft`削除~~ ✅2026-01-13完了

**マニュアルmd分離: 完了**

---

## フロー・ガイドラインのmd分離（2026-01-13完了）

tsunageru.tsの`overallFlow`, `detailedFlow`, `memo`, `format`（ガイドライン）を外部mdファイルに分離。

**ファイル配置:**
```
docs/
├── flows/tsunageru/        # フロー
│   ├── overall-flow.md     # ← Task 5 overallFlow
│   ├── feedback-flow.md    # ← Task 14 memo
│   └── monthly-fb-flow.md  # ← Task 14 detailedFlow
└── guidelines/tsunageru/   # ガイドライン
    └── job-posting-guideline.md  # ← Task 9 format（差別化求人原稿ガイドライン）
```

**読み込み関数:**（lib/manuals.ts）
- `getFlow(productId, flowName)` → フロー読み込み
- `getGuideline(productId, guidelineName)` → ガイドライン読み込み

**UI対応:**
- `overall-flow/page.tsx` → Server Component化、mdファイル読み込み対応
- `flow/page.tsx` → Server Component化、mdファイル読み込み対応

**削減効果:**
- tsunageru.ts: 2,438行 → 1,825行（613行削減）

**フロー・ガイドラインmd分離: 完了**

---

## サイドメニュー実装（2026-01-13完了）

商材ページ（`/products/[id]`）に開閉式サイドメニューを実装。

**機能:**
- 全体フロー（商材レベル）へのリンク
- タスク一覧（アンカースクロール）
- マニュアル一覧（別タブで開く）
- フォーマット一覧（モーダル表示）

**コンポーネント構成:**
```
src/components/
├── Sidebar.tsx           # サイドメニュー本体
├── SidebarSection.tsx    # アコーディオンセクション
└── ProductPageLayout.tsx # 2カラムレイアウト管理
```

**特徴:**
- デスクトップ: 固定幅（w-64）、左右スライド式
- モバイル: 画面幅いっぱい、背景透過（95%）、スクロール後に自動閉じ
- lucide-reactでアイコン統一

**全体フローの配置変更:**
- 以前: Task 5に`hasOverallFlow`を設定
- 現在: 商材レベル（Product型）に`hasOverallFlow`を設定
- URL: `/products/{productId}/overall-flow`

**関連ファイル:**
- `src/app/products/[id]/page.tsx` - 2カラムレイアウト、ヘッダー改修
- `src/app/products/[id]/overall-flow/page.tsx` - 商材レベル全体フローページ
- `src/lib/data/index.ts` - Product型に`hasOverallFlow`追加

---

## ボタン表示問題の解決（2026-01-13完了）

**問題:**
md分離後、TaskCardの「マニュアル」「全体フロー」「詳細フロー」ボタンが表示されなかった。

**原因:**
`hasAnyDetail`変数が`manualDraft`, `overallFlow`, `detailedFlow`の存在をチェックしていたが、`hasManual`, `hasOverallFlow`, `hasDetailedFlow`フラグをチェックしていなかった。

**修正内容:**（TaskCard.tsx）
```typescript
// 修正前
const hasAnyDetail =
  task.manualDraft ||
  task.overallFlow ||
  task.detailedFlow || ...

// 修正後
const hasAnyDetail =
  task.manualDraft || task.hasManual ||
  task.overallFlow || task.hasOverallFlow ||
  task.detailedFlow || task.hasDetailedFlow || ...

// マニュアルボタン条件も修正
{(task.manualDraft || task.hasManual) && (...)}
```

---

## モバイル対応（2026-01-13完了）

商材ページとTaskCardのレスポンシブ対応を実装。

**対応内容:**
- ヘッダー: アイコン・タイトルサイズ調整、descriptionはmd以上で表示
- サイドメニュー: モバイルでは画面幅いっぱい、背景透過、スクロール後自動閉じ
- TaskCardヘッダー: モバイルでは縦並びレイアウト
- フローステップ: モバイルでは縦並び、矢印は「↓」に変更
- 余白: モバイルでは小さめに調整

---

## 使用パッケージ

```bash
# マークダウンレンダリング
npm install react-markdown remark-gfm rehype-raw

# アイコン
npm install lucide-react
```

---

## 将来の改善

### プロンプトの入力キー・保存キー管理

現在`getInputKeyForPrompt()`は`DEFAULT_SAVE_KEY_MAPPING`（ハードコード）から取得している。プロンプトシートで管理するように改善する。

**背景:**
- 各プロンプトには「入力キー」（Part③のどのラベルから入力を取得するか）と「保存キー」（Part③のどのラベルに出力を保存するか）が必要
- 現在は一部のプロンプトのみハードコードで定義
- すべてのプロンプトで設定可能にすべき

**対象プロンプト:**
- 議事録作成 → 入力:文字起こし原文 / 保存:議事録
- ヒアリング情報抽出 → 入力:文字起こし原文 / 保存:ヒアリング抽出JSON
- 構成案作成 → 入力:議事録 / 保存:構成案
- ペアソナ/エンゲージ変換 → 入力:構成案 / 保存:ペアソナ/エンゲージ
- ワークス報告変換 → 入力:構成案 / 保存:（なし？）
- 撮影指示書変換 → 入力:構成案 / 保存:撮影指示書

**設計検討事項:**
1. プロンプトシートに「入力キー」「保存キー」列を追加する案
2. プロンプト編集ダイアログで設定できるようにする
3. `getInputKeyForPrompt()` / `getSaveKeyForPrompt()` をプロンプトシートから取得するように変更

**関連ファイル:**
- `docs/gas/tsunageru/settingsSheet.js` - `getInputKeyForPrompt()`, `DEFAULT_SAVE_KEY_MAPPING`
- `docs/gas/tsunageru/promptDialog.js` - プロンプト編集ダイアログ

---

### 「各種フォーマット」シートの作成
メールテンプレートなどのフォーマットを「各種フォーマット」シートから取得するように改善する。

**実装タスク:**
1. 設定メニューに「📋 各種フォーマットシートを作成」「📝 各種フォーマット編集」を追加
2. `initializeFormatSheet()` - 各種フォーマットシート作成関数
3. `showFormatEditDialog()` - 各種フォーマット編集ダイアログ
4. `getFormatFromSheet(formatName)` - フォーマット取得関数

---

## 開発コマンド

```bash
npx tsc --noEmit    # TypeScriptエラーチェック（コード変更後は必ず実行）
```

---

## 担当者一覧（ツナゲル）

| 担当者 | 色 | 主な業務 |
|--------|-----|---------|
| 渡邉 | グレー | 受注・立ち上げ、日程調整 |
| 河合 | ピンク | 打ち合わせ、原稿、編集 |
| 中尾文香 | 黄色 | 原稿執筆 |
| 川崎 | 水色 | 企画、撮影、FB |
| 下脇田 | 紫 | FB |
| 紺谷 | オレンジ | 応募対応 |

---

## 更新履歴

| 日付 | 内容 |
|------|------|
| 2026-01-14 | GAS最適化: settingsSheet.js 4ダイアログにCI_DIALOG_STYLES/CI_UI_COMPONENTS適用、サイズ700x750統一、手動変更可能の説明追加 |
| 2026-01-14 | GAS最適化: commonStyles.jsにbtn-add、btn-delete追加 |
| 2026-01-14 | GAS最適化レポート作成（docs/gas-optimization-report.md）、将来改善に入力キー・保存キー管理を追加 |
| 2026-01-14 | 全14タスクのflowStepsに「ステータス更新」ステップを追加、表現ルール統一（GAS→ヒアリングシートのメニュー） |
| 2026-01-14 | ガイドラインv3更新（表現ルール、ステータス更新ステップ追加、品質チェック項目追加） |
| 2026-01-14 | 商材ページUI改善: 業務数・課題・サマリーを最下部に移動してアコーディオン化、Accordion.tsx新規作成 |
| 2026-01-14 | タスク定義を設定シートから取得するように変更（progressManager.js→getTasks()、hearingSheetManager.js連携） |
| 2026-01-14 | タスク統合（15→14タスク）: No.0とNo.1を統合、マニュアル・tsunageru.ts・GAS更新 |
| 2026-01-14 | ステータス更新ダイアログを全メニューに追加（企業情報入力、初回打ち合わせ、議事録作成、構成案作成、連絡フォーマット） |
| 2026-01-14 | 更新ログ機能追加（I〜N列、タスク変更・保持者変更・状態・メモ・工数を記録） |
| 2026-01-14 | ステータス欄を6項目に拡張（状態・全体ステータス追加、条件付き書式追加） |
| 2026-01-14 | 進捗管理機能実装（progressManager.js、ステータス管理・進捗一覧・進捗ログ） |
| 2026-01-14 | フローステップUI微調整（カード幅w-40、余白調整、ボタン統一、タイトル左余白ml-1） |
| 2026-01-14 | フローステップタイトル改善（タイトル簡潔化、summary追加、ボタン絵文字削除） |
| 2026-01-14 | モバイルハンバーガーメニュー実装（ProductPageLayoutにヘッダー統合、Menu↔Xアニメーション） |
| 2026-01-14 | フローステップデザイン完了（FlowStep.summary追加、ステップ番号バッジ、丸枠矢印、サイズ統一） |
| 2026-01-13 | フローステップデザイン改善（途中）: Task型にsummary追加、lucide-react矢印導入 |
| 2026-01-13 | ガイドラインV3作成（新商材作成の完全ガイド、設計思想・共通概念・ルール・作り方） |
| 2026-01-13 | フォーマット共通化（FB_REPORT_TEMPLATE, SHOOTING_CHECKLIST）3商材で共有 |
| 2026-01-13 | モバイル対応（ヘッダー、サイドメニュー、TaskCard、フローステップ） |
| 2026-01-13 | サイドメニュー実装（Sidebar.tsx、SidebarSection.tsx、ProductPageLayout.tsx） |
| 2026-01-13 | 全体フローを商材レベルに移動（/products/{id}/overall-flow） |
| 2026-01-13 | lucide-reactインストール、アイコン統一 |
| 2026-01-13 | ボタン表示問題解決（hasAnyDetailにフラグ追加、マニュアルボタン条件修正） |
| 2026-01-13 | フロー・ガイドラインmd分離完了（docs/flows/, docs/guidelines/、613行削減） |
| 2026-01-13 | tsunageru.tsのmanualDraft全削除完了（md分離作業完了） |
| 2026-01-13 | 全14タスクのmdファイル作成完了（docs/manuals/tsunageru/に00〜13のマニュアル） |
| 2026-01-13 | マークダウンスタイル問題修正（globals.css、ManualMarkdownRenderer.tsx更新、engineer-course準拠） |
| 2026-01-13 | マニュアルmd分離実装（Server Component方式に変更、lib/manuals.ts、ManualMarkdownRenderer.tsx） |
| 2026-01-13 | マニュアルmd分離の設計決定（react-markdown + rehype-raw、HTML埋め込み対応） |
| 2026-01-13 | Next.jsサイト共通化（common/manuals, common/templates）、ワークススタンプルール追加 |
| 2026-01-13 | 撮影関連情報フロー実装、日程調整メール更新、GASメニュー名変更 |
| 2026-01-13 | 企業カンペ機能実装（3シート構成、5列化、チェックボックス） |
| 2026-01-13 | 撮影日程確定報告ダイアログ実装 |
| 2026-01-12 | Part③構成を設定シートで管理、保存機能追加 |
| 2026-01-12 | 全ダイアログをドロップダウンUI形式に統一 |
| 2026-01-12 | プロンプトシートにカテゴリ列追加 |
| 2026-01-11 | 企業選択UI共通化、commonStyles.js作成 |
| 2026-01-11 | GASメニュー構成変更、companyInfoManager.js新規作成 |
| 2026-01-10 | 入力データの永続化（Part③）、撮影フォルダ作成改善 |
| 2026-01-10 | settingsSheet.js作成、contactFormats.js作成 |
